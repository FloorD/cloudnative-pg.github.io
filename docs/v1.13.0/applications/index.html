<!DOCTYPE html>




<html lang="en">

<head>
  <title>CloudNative PG</title>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta http-equiv="X-UA-Compatible" content="ie=edge" />
  <meta name="description" content="CloudNativePG is the Kubernetes operator that covers the full lifecycle of a highly available PostgreSQL database cluster with a primary/standby architecture, using native streaming replication." />
  <meta name="keywords" content="" />
  <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,700" rel="stylesheet" />
  <link href="/main.min.css" rel="stylesheet" />
  <link rel="favicon" href="/favicon/favicon.ico">
</head>

<body>
  <div class="h-screen w-screen">
    
<main>
  <header>
    <div class="flex flex-row px-16 justify-between py-5">
      <div>
        
        <a href="/"><img src="/logo/large_logo.svg" class="h-14" alt="Cloud Native Postgres Logo"></a>
      </div>
      <div>
        <ul class="flex gap-14 text-2xl text-slate-400 my-5">
          <li><a href="/docs/1.15.0/" target="_blank">Documentation</a></li>
          <li>Support</li>
          <li>End users</li>
          <li>Blog</li>
        </ul>
      </div>
      <div class="flex gap-5 my-4">
        <a href="https://github.com/cloudnative-pg/cloudnative-pg">
          <img src="/icons/Git.svg" alt="Github">
        </a>
        <a href="https://cloudnativepg.slack.com/">
          <img src="/icons/Slack.svg" alt="Slack">
        </a>
        <a href="https://twitter.com/CloudNativePg">
          <img src="/icons/Twitter.svg" alt="Twitter">
        </a>
        <a href="https://www.youtube.com/channel/UCTGH88W1BiuRRPTzJUDPJyA">
          <img src="/icons/YouTube.svg" alt="YouTube">
        </a>
      </div>
    </div>
  </header>
</main>


    
<h2 class="text-2xl"></h2>
<h1 id="connecting-from-an-application">Connecting from an application</h1>
<p>Applications are supposed to work with the services created by Cloud Native PostgreSQL
in the same Kubernetes cluster:</p>
<ul>
<li><code>[cluster name]-rw</code></li>
<li><code>[cluster name]-ro</code></li>
<li><code>[cluster name]-r</code></li>
</ul>
<p>Those services are entirely managed by the Kubernetes cluster and
implement a form of Virtual IP as described in the
<a href="https://kubernetes.io/docs/concepts/services-networking/service/#virtual-ips-and-service-proxies">&ldquo;Service&rdquo; page of the Kubernetes Documentation</a>.</p>
<p>!!! Hint
It is highly recommended using those services in your applications,
and avoiding connecting directly to a specific PostgreSQL instance, as the latter
can change during the cluster lifetime.</p>
<p>You can use these services in your applications through:</p>
<ul>
<li>DNS resolution</li>
<li>environment variables</li>
</ul>
<p>For the credentials to connect to PostgreSQL, you can
use the secrets generated by the operator.</p>
<p>!!! Warning
The operator will create another service, named <code>[cluster name]-any</code>. That
service is used internally to manage PostgreSQL instance discovery.
It&rsquo;s not supposed to be used directly by applications.</p>
<p>!!! Seealso &ldquo;Connection Pooling&rdquo;
Please refer to the <a href="connection_pooling.md">&ldquo;Connection Pooling&rdquo; section</a> for
information about how to take advantage of PgBouncer as a connection pooler,
and create an access layer between your applications and the PostgreSQL clusters.</p>
<h3 id="dns-resolution">DNS resolution</h3>
<p>You can use the Kubernetes DNS service to point to a given server.
The Kubernetes DNS service is required by the operator.
You can do that by using the name of the service if the application is
deployed in the same namespace as the PostgreSQL cluster.
In case the PostgreSQL cluster resides in a different namespace, you can use the
full qualifier: <code>service-name.namespace-name</code>.</p>
<p>DNS is the preferred and recommended discovery method.</p>
<h3 id="environment-variables">Environment variables</h3>
<p>If you deploy your application in the same namespace that contains the
PostgreSQL cluster, you can also use environment variables to connect to the database.</p>
<p>For example, suppose that your PostgreSQL cluster is called <code>pg-database</code>,
you can use the following environment variables in your applications:</p>
<ul>
<li>
<p><code>PG_DATABASE_R_SERVICE_HOST</code>: the IP address of the service
pointing to all the PostgreSQL instances for read-only workloads</p>
</li>
<li>
<p><code>PG_DATABASE_RO_SERVICE_HOST</code>: the IP address of the
service pointing to all hot-standby replicas of the cluster</p>
</li>
<li>
<p><code>PG_DATABASE_RW_SERVICE_HOST</code>: the IP address of the
service pointing to the <em>primary</em> instance of the cluster</p>
</li>
</ul>
<h3 id="secrets">Secrets</h3>
<p>The PostgreSQL operator will generate two <code>basic-auth</code> type secrets for every
PostgreSQL cluster it deploys:</p>
<ul>
<li><code>[cluster name]-superuser</code></li>
<li><code>[cluster name]-app</code></li>
</ul>
<p>The secrets contain the username, password, and a working
<a href="https://www.postgresql.org/docs/current/libpq-pgpass.html"><code>.pgpass file</code></a>
respectively for the <code>postgres</code> user and the <em>owner</em> of the database.</p>
<p>The <code>-app</code> credentials are the ones that should be used by applications
connecting to the PostgreSQL cluster.</p>
<p>The <code>-superuser</code> ones are supposed to be used only for administrative purposes.</p>



    <footer class="text-center p-24">
    <div>
        <a href="#" class="bg-rose-600 py-4 px-12 rounded-full text-white text-xl">View on GitHub</a>
    </div>
    <p class="text-sm text-slate-600 w-1/2 mx-auto pt-10">&copy; 2019-2022 The CloudNativePG Contributors<br/>
    The Linux Foundation has registered trademarks and uses trademarks. 
    For a list of trademarks of The Linux Foundation, please see our <a href="https://www.linuxfoundation.org/trademark-usage/" class="text-rose-600">Trademark Usage page</a>.<br/>
    Postgres, PostgreSQL and the Slonik Logo are trademarks or registered trademarks of the PostgreSQL Community Association of Canada, and used with their permission.
    </p>
</footer>

  </div>
  
  <script src="https://cdn.usefathom.com/script.js" data-site="GSMQCVAJ" defer></script>
  
</body>

</html>
<!DOCTYPE html>




<html lang="en">

<head>
  <title>CloudNative PG</title>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta http-equiv="X-UA-Compatible" content="ie=edge" />
  <meta name="description" content="CloudNativePG is the Kubernetes operator that covers the full lifecycle of a highly available PostgreSQL database cluster with a primary/standby architecture, using native streaming replication." />
  <meta name="keywords" content="" />
  <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,700" rel="stylesheet" />
  <link href="/main.min.css" rel="stylesheet" />
</head>

<body>
  <div class="h-screen w-screen">
    
<main>
  <header>
    <div class="flex flex-row px-16 justify-between py-5">
      <div>
        
        <a href="/"><img src="/logo/large_logo.svg" class="h-14" alt="Cloud Native Postgres Logo"></a>
      </div>
      <div>
        <ul class="flex gap-14 text-2xl text-slate-400 my-5">
          <li><a href="/docs/1.15.0/" target="_blank">Documentation</a></li>
          <li>Support</li>
          <li>End users</li>
          <li>Blog</li>
        </ul>
      </div>
      <div class="flex gap-5 my-4">
        <a href="https://github.com/cloudnative-pg/cloudnative-pg">
          <img src="/icons/Git.svg" alt="Github">
        </a>
        <a href="https://cloudnativepg.slack.com/">
          <img src="/icons/Slack.svg" alt="Slack">
        </a>
        <a href="https://twitter.com/CloudNativePg">
          <img src="/icons/Twitter.svg" alt="Twitter">
        </a>
        <a href="https://www.youtube.com/channel/UCTGH88W1BiuRRPTzJUDPJyA">
          <img src="/icons/YouTube.svg" alt="YouTube">
        </a>
      </div>
    </div>
  </header>
</main>


    
<h2 class="text-2xl"></h2>
<h1 id="postgresql-configuration">PostgreSQL Configuration</h1>
<p>Users that are familiar with PostgreSQL are aware of the existence of the following two files
to configure an instance:</p>
<ul>
<li><code>postgresql.conf</code>: main run-time configuration file of PostgreSQL</li>
<li><code>pg_hba.conf</code>: clients authentication file</li>
</ul>
<p>Due to the concepts of declarative configuration and immutability of the PostgreSQL
containers, users are not allowed to directly touch those files. Configuration
is possible through the <code>postgresql</code> section of the <code>Cluster</code> resource definition
by defining custom <code>postgresql.conf</code> and <code>pg_hba.conf</code> settings via the
<code>parameters</code> and the <code>pg_hba</code> keys.</p>
<p>These settings are the same across all instances.</p>
<p>!!! Warning
Please don&rsquo;t use the <code>ALTER SYSTEM</code> query to change the configuration of
the PostgreSQL instances in an imperative way. Changing some of the options
that are normally controlled by the operator might indeed lead to an
unpredictable/unrecoverable state of the cluster.
Moreover, <code>ALTER SYSTEM</code> changes are not replicated across the cluster.</p>
<p>A reference for custom settings usage is included in the samples, see
<a href="samples/cluster-example-custom.yaml"><code>cluster-example-custom.yaml</code></a>.</p>
<p>!!! Warning
<strong>OpenShift users:</strong> due to a current limitation of the OpenShift user interface,
it is possible to change PostgreSQL settings from the YAML pane only.</p>
<h2 id="the-postgresql-section">The <code>postgresql</code> section</h2>
<p>The PostgreSQL instance in the pod starts with a default <code>postgresql.conf</code> file,
to which these settings are automatically added:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>listen_addresses = &#39;*&#39;
</span></span><span style="display:flex;"><span>include custom.conf
</span></span></code></pre></div><p>The <code>custom.conf</code> file will contain the user-defined settings in the
<code>postgresql</code> section, as in the following example:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span>  <span style="color:#75715e"># ...</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">postgresql</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">parameters</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">shared_buffers</span>: <span style="color:#e6db74">&#34;1GB&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># ...</span>
</span></span></code></pre></div><p>!!! Seealso &ldquo;PostgreSQL GUCs: Grand Unified Configuration&rdquo;
Refer to the PostgreSQL documentation for
<a href="https://www.postgresql.org/docs/current/runtime-config.html">more information on the available parameters</a>,
also known as GUC (Grand Unified Configuration).</p>
<p>The content of <code>custom.conf</code> is automatically generated and maintained by the
operator by applying the following sections in this order:</p>
<ul>
<li>Global default parameters</li>
<li>Default parameters that depend on the PostgreSQL major version</li>
<li>User-provided parameters</li>
<li>Fixed parameters</li>
</ul>
<p>The <strong>global default parameters</strong> are:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>dynamic_shared_memory_type = &#39;posix&#39;
</span></span><span style="display:flex;"><span>logging_collector = &#39;on&#39;
</span></span><span style="display:flex;"><span>log_destination = &#39;csvlog&#39;
</span></span><span style="display:flex;"><span>log_directory = &#39;/controller/log&#39;
</span></span><span style="display:flex;"><span>log_filename = &#39;postgres&#39;
</span></span><span style="display:flex;"><span>log_rotation_age = &#39;0&#39;
</span></span><span style="display:flex;"><span>log_rotation_size = &#39;0&#39;
</span></span><span style="display:flex;"><span>log_truncate_on_rotation = &#39;false&#39;
</span></span><span style="display:flex;"><span>max_parallel_workers = &#39;32&#39;
</span></span><span style="display:flex;"><span>max_replication_slots = &#39;32&#39;
</span></span><span style="display:flex;"><span>max_worker_processes = &#39;32&#39;
</span></span><span style="display:flex;"><span>shared_memory_type = &#39;mmap&#39; # for PostgreSQL &gt;= 12 only
</span></span><span style="display:flex;"><span>wal_keep_size = &#39;512MB&#39; # for PostgreSQL &gt;= 13 only
</span></span><span style="display:flex;"><span>wal_keep_segments = &#39;32&#39; # for PostgreSQL &lt;= 12 only
</span></span><span style="display:flex;"><span>wal_sender_timeout = &#39;5s&#39;
</span></span><span style="display:flex;"><span>wal_receiver_timeout = &#39;5s&#39;
</span></span></code></pre></div><p>!!! Warning
It is your duty to plan for WAL segments retention in your PostgreSQL
cluster and properly configure either <code>wal_keep_size</code> or <code>wal_keep_segments</code>,
depending on the server version, based on the expected and observed workloads.
Until Cloud Native PostgreSQL supports replication slots, and if you don&rsquo;t have
continuous backup in place, this is the only way at the moment that protects
from the case of a standby falling out of sync and returning error messages like:
<code>&quot;could not receive data from WAL stream: ERROR: requested WAL segment ************************ has already been removed&quot;</code>.
This will require you to dedicate a part of your <code>PGDATA</code> to keep older
WAL segments for streaming replication purposes.</p>
<p>The following parameters are <strong>fixed</strong> and exclusively controlled by the operator:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>archive_command = &#39;/controller/manager wal-archive %p&#39;
</span></span><span style="display:flex;"><span>archive_mode = &#39;on&#39;
</span></span><span style="display:flex;"><span>archive_timeout = &#39;5min&#39;
</span></span><span style="display:flex;"><span>full_page_writes = &#39;on&#39;
</span></span><span style="display:flex;"><span>hot_standby = &#39;true&#39;
</span></span><span style="display:flex;"><span>listen_addresses = &#39;*&#39;
</span></span><span style="display:flex;"><span>port = &#39;5432&#39;
</span></span><span style="display:flex;"><span>restart_after_crash = &#39;false&#39;
</span></span><span style="display:flex;"><span>ssl = &#39;on&#39;
</span></span><span style="display:flex;"><span>ssl_ca_file = &#39;/controller/certificates/client-ca.crt&#39;
</span></span><span style="display:flex;"><span>ssl_cert_file = &#39;/controller/certificates/server.crt&#39;
</span></span><span style="display:flex;"><span>ssl_key_file = &#39;/controller/certificates/server.key&#39;
</span></span><span style="display:flex;"><span>unix_socket_directories = &#39;/var/run/postgresql&#39;
</span></span><span style="display:flex;"><span>wal_level = &#39;logical&#39;
</span></span><span style="display:flex;"><span>wal_log_hints = &#39;on&#39;
</span></span></code></pre></div><p>Since the fixed parameters are added at the end, they can&rsquo;t be overridden by the
user via the YAML configuration. Those parameters are required for correct WAL
archiving and replication.</p>
<h3 id="replication-settings">Replication settings</h3>
<p>The <code>primary_conninfo</code>, <code>restore_command</code>,  and <code>recovery_target_timeline</code>
parameters are managed automatically by the operator according to the state of
the instance in the cluster.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>primary_conninfo = &#39;host=cluster-example-rw user=postgres dbname=postgres&#39;
</span></span><span style="display:flex;"><span>recovery_target_timeline = &#39;latest&#39;
</span></span></code></pre></div><h3 id="log-control-settings">Log control settings</h3>
<p>The operator requires PostgreSQL to output its log in CSV format, and the
instance manager automatically parses it and outputs it in JSON format.
For this reason, all log settings in PostgreSQL are fixed and cannot be
changed.</p>
<p>For further information, please refer to the <a href="logging.md">&ldquo;Logging&rdquo; section</a>.</p>
<h3 id="shared-preload-libraries">Shared Preload Libraries</h3>
<p>The <code>shared_preload_libraries</code> option in PostgreSQL exists to specify one or
more shared libraries to be pre-loaded at server start, in the form of a
comma-separated list. Typically, it is used in PostgreSQL to load those
extensions that need to be available to most database sessions in the whole system
(e.g. <code>pg_stat_statements</code>).</p>
<p>In Cloud Native PostgreSQL the <code>shared_preload_libraries</code> option is empty by
default. Although you can override the content of <code>shared_preload_libraries</code>,
we recommend that only expert Postgres users take advantage of this option.</p>
<p>!!! Important
In case a specified library is not found, the server fails to start,
preventing Cloud Native PostgreSQL from any self-healing attempt and requiring
manual intervention. Please make sure you always test both the extensions and
the settings of <code>shared_preload_libraries</code> if you plan to directly manage its
content.</p>
<p>Cloud Native PostgreSQL is able to automatically manage the content of the
<code>shared_preload_libraries</code> option for some of the most used PostgreSQL
extensions (see the <a href="#managed-extensions">&ldquo;Managed extensions&rdquo;</a> section below
for details).</p>
<p>Specifically, as soon as the operator notices that a configuration parameter
requires one of the managed libraries, it will automatically add the needed
library. The operator will also remove the library as soon as no actual parameter
requires it.</p>
<p>!!! Important
Please always keep in mind that removing libraries from
<code>shared_preload_libraries</code> requires a restart of all instances in the cluster
in order to be effective.</p>
<p>You can provide additional <code>shared_preload_libraries</code> via
<code>.spec.postgresql.shared_preload_libraries</code> as a list of strings: the operator
will merge them with the ones that it automatically manages.</p>
<h3 id="managed-extensions">Managed extensions</h3>
<p>As anticipated in the previous section, Cloud Native PostgreSQL automatically
manages the content in <code>shared_preload_libraries</code> for some well-known and
supported extensions. The current list includes:</p>
<ul>
<li><code>auto_explain</code></li>
<li><code>pg_stat_statements</code></li>
<li><code>pgaudit</code></li>
</ul>
<p>Some of these libraries also require additional objects in a database before
using them, normally views and/or functions managed via the <code>CREATE EXTENSION</code>
command to be run in a database (the <code>DROP EXTENSION</code> command typically removes
those objects).</p>
<p>For such libraries, Cloud Native PostgreSQL automatically handles the creation
and removal of the extension in all databases that accept a connection in the
cluster, identified by the following query:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">SELECT</span> datname <span style="color:#66d9ef">FROM</span> pg_database <span style="color:#66d9ef">WHERE</span> datallowconn
</span></span></code></pre></div><p>!!! Note
The above query also includes template databases like <code>template1</code>.</p>
<h4 id="enabling-auto_explain">Enabling <code>auto_explain</code></h4>
<p>The <a href="https://www.postgresql.org/docs/current/auto-explain.html"><code>auto_explain</code></a>
extension provides a means for logging execution plans of slow statements
automatically, without having to manually run <code>EXPLAIN</code> (helpful for tracking
down un-optimized queries).</p>
<p>You can enable <code>auto_explain</code> by adding to the configuration a parameter
that starts with <code>auto_explain.</code> as in the following example excerpt (which
automatically logs execution plans of queries that take longer than 10 seconds
to complete):</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span>  <span style="color:#75715e"># ...</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">postgresql</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">parameters</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">auto_explain.log_min_duration</span>: <span style="color:#e6db74">&#34;10s&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># ...</span>
</span></span></code></pre></div><p>!!! Note
Enabling auto_explain can lead to performance issues. Please refer to <a href="https://www.postgresql.org/docs/current/auto-explain.html"><code>the auto explain documentation</code></a></p>
<h4 id="enabling-pg_stat_statements">Enabling <code>pg_stat_statements</code></h4>
<p>The <a href="https://www.postgresql.org/docs/current/pgstatstatements.html"><code>pg_stat_statements</code></a>
extension is one of the most important capabilities available in PostgreSQL for
real-time monitoring of queries.</p>
<p>You can enable <code>pg_stat_statements</code> by adding to the configuration a parameter
that starts with <code>pg_stat_statements.</code> as in the following example excerpt:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span>  <span style="color:#75715e"># ...</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">postgresql</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">parameters</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">pg_stat_statements.max</span>: <span style="color:#e6db74">&#34;10000&#34;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">pg_stat_statements.track</span>: <span style="color:#ae81ff">all</span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># ...</span>
</span></span></code></pre></div><p>As explained previously, the operator will automatically add
<code>pg_stat_statements</code> to <code>shared_preload_libraries</code> and run <code>CREATE EXTENSION IF NOT EXISTS pg_stat_statements</code> on each database, enabling you to run queries
against the <code>pg_stat_statements</code> view.</p>
<h4 id="enabling-pgaudit">Enabling <code>pgaudit</code></h4>
<p>The <code>pgaudit</code> extension provides detailed session and/or object audit logging via the standard PostgreSQL logging facility.</p>
<p>Cloud Native PostgreSQL has transparent and native support for
<a href="https://www.pgaudit.org/">PGAudit</a> on PostgreSQL clusters. For further information, please refer to the <a href="logging.md#pgaudit-logs">&ldquo;PGAudit&rdquo; logs section.</a></p>
<p>You can enable <code>pgaudit</code> by adding to the configuration a parameter
that starts with <code>pgaudit.</code> as in the following example excerpt:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#75715e">#</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">postgresql</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">parameters</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">pgaudit.log</span>: <span style="color:#e6db74">&#34;all, -misc&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">pgaudit.log_catalog</span>: <span style="color:#e6db74">&#34;off&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">pgaudit.log_parameter</span>: <span style="color:#e6db74">&#34;on&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">pgaudit.log_relation</span>: <span style="color:#e6db74">&#34;on&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#</span>
</span></span></code></pre></div><h2 id="the-pg_hba-section">The <code>pg_hba</code> section</h2>
<p><code>pg_hba</code> is a list of PostgreSQL Host Based Authentication rules
used to create the <code>pg_hba.conf</code> used by the pods.</p>
<p>Since the first matching rule is used for authentication, the <code>pg_hba.conf</code> file
generated by the operator can be seen as composed of three sections:</p>
<ol>
<li>Fixed rules</li>
<li>User-defined rules</li>
<li>Default rules</li>
</ol>
<p>Fixed rules:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>local all all peer
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>hostssl postgres streaming_replica all cert
</span></span><span style="display:flex;"><span>hostssl replication streaming_replica all cert
</span></span></code></pre></div><p>Default rules:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>host all all all &lt;default-authentication-method&gt;
</span></span></code></pre></div><p>From PostgreSQL 14 the default value of the <code>password_encryption</code>
database parameter is set to <code>scram-sha-256</code>. Because of that,
the default authentication method is <code>scram-sha-256</code> from this
PostgreSQL version.</p>
<p>PostgreSQL 13 and older will use <code>md5</code> as the default authentication
method.</p>
<p>The resulting <code>pg_hba.conf</code> will look like this:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>local all all peer
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>hostssl postgres streaming_replica all cert
</span></span><span style="display:flex;"><span>hostssl replication streaming_replica all cert
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>&lt;user defined rules&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>host all all all scram-sha-256 # (or md5 for PostgreSQL version &lt;= 13)
</span></span></code></pre></div><p>Refer to the PostgreSQL documentation for <a href="https://www.postgresql.org/docs/current/auth-pg-hba-conf.html">more information on <code>pg_hba.conf</code></a>.</p>
<h2 id="changing-configuration">Changing configuration</h2>
<p>You can apply configuration changes by editing the <code>postgresql</code> section of
the <code>Cluster</code> resource.</p>
<p>After the change, the cluster instances will immediately reload the
configuration to apply the changes.
If the change involves a parameter requiring a restart, the operator will
perform a rolling upgrade.</p>
<h2 id="dynamic-shared-memory-settings">Dynamic Shared Memory settings</h2>
<p>PostgreSQL supports a few implementations for dynamic shared memory
management through the
<a href="https://www.postgresql.org/docs/current/runtime-config-resource.html#GUC-DYNAMIC-SHARED-MEMORY-TYPE"><code>dynamic_shared_memory_type</code></a>
configuration option. In Cloud Native PostgreSQL we recommend to limit ourselves to
any of the following two values:</p>
<ul>
<li><code>posix</code>: which relies on POSIX shared memory allocated using <code>shm_open</code> (default setting)</li>
<li><code>sysv</code>: which is based on System V shared memory allocated via <code>shmget</code></li>
</ul>
<p>In PostgreSQL, this setting is particularly important for memory allocation in parallel queries.
For details, please refer to this
<a href="https://www.postgresql.org/message-id/CA%2BhUKGJOj7qzDLxeFPVvto8YEWop6FSQoTYPO9Z6Ee%3Di-nPS_Q%40mail.gmail.com">thread from the <code>pgsql-general</code> mailing list</a>.</p>
<h3 id="posix-shared-memory">POSIX shared memory</h3>
<p>The default setting of <code>posix</code> should be enough in most cases, considering that
the operator automatically mounts a <em>memory-bound <code>EmptyDir</code> volume</em> called <code>shm</code>
under <code>/dev/shm</code>. You can verify the size of such volume inside the running
Postgres container with:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>mount | grep shm
</span></span></code></pre></div><p>You should get something similar to the following output:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span>shm on /dev/shm type tmpfs (rw,nosuid,nodev,noexec,relatime,size=******)
</span></span></code></pre></div><h3 id="system-v-shared-memory">System V shared memory</h3>
<p>In case your Kubernetes cluster has a high enough value for the <code>SHMMAX</code>
and <code>SHMALL</code> parameters, you can also set:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">dynamic_shared_memory_type</span>: <span style="color:#e6db74">&#34;sysv&#34;</span>
</span></span></code></pre></div><p>You can check the <code>SHMMAX</code>/<code>SHMALL</code> from inside a PostgreSQL container, by running:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>ipcs -lm
</span></span></code></pre></div><p>For example:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span>------ Shared Memory Limits --------
</span></span><span style="display:flex;"><span>max number of segments = 4096
</span></span><span style="display:flex;"><span>max seg size (kbytes) = 18014398509465599
</span></span><span style="display:flex;"><span>max total shared memory (kbytes) = 18014398509481980
</span></span><span style="display:flex;"><span>min seg size (bytes) = 1
</span></span></code></pre></div><p>As you can see, the very high number of <code>max total shared memory</code> recommends
setting <code>dynamic_shared_memory_type</code> to <code>sysv</code>.</p>
<p>An alternate method is to run:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>cat /proc/sys/kernel/shmall
</span></span><span style="display:flex;"><span>cat /proc/sys/kernel/shmmax
</span></span></code></pre></div><h2 id="fixed-parameters">Fixed parameters</h2>
<p>Some PostgreSQL configuration parameters should be managed exclusively by the
operator. The operator prevents the user from setting them using a webhook.</p>
<p>Users are not allowed to set the following configuration parameters in the
<code>postgresql</code> section:</p>
<ul>
<li><code>allow_system_table_mods</code></li>
<li><code>archive_cleanup_command</code></li>
<li><code>archive_command</code></li>
<li><code>archive_mode</code></li>
<li><code>archive_timeout</code></li>
<li><code>bonjour</code></li>
<li><code>bonjour_name</code></li>
<li><code>cluster_name</code></li>
<li><code>config_file</code></li>
<li><code>data_directory</code></li>
<li><code>data_sync_retry</code></li>
<li><code>event_source</code></li>
<li><code>external_pid_file</code></li>
<li><code>full_page_writes</code></li>
<li><code>hba_file</code></li>
<li><code>hot_standby</code></li>
<li><code>huge_pages</code></li>
<li><code>ident_file</code></li>
<li><code>jit_provider</code></li>
<li><code>listen_addresses</code></li>
<li><code>log_destination</code></li>
<li><code>log_directory</code></li>
<li><code>log_file_mode</code></li>
<li><code>log_filename</code></li>
<li><code>log_rotation_age</code></li>
<li><code>log_rotation_size</code></li>
<li><code>log_truncate_on_rotation</code></li>
<li><code>logging_collector</code></li>
<li><code>port</code></li>
<li><code>primary_conninfo</code></li>
<li><code>primary_slot_name</code></li>
<li><code>promote_trigger_file</code></li>
<li><code>recovery_end_command</code></li>
<li><code>recovery_min_apply_delay</code></li>
<li><code>recovery_target</code></li>
<li><code>recovery_target_action</code></li>
<li><code>recovery_target_inclusive</code></li>
<li><code>recovery_target_lsn</code></li>
<li><code>recovery_target_name</code></li>
<li><code>recovery_target_time</code></li>
<li><code>recovery_target_timeline</code></li>
<li><code>recovery_target_xid</code></li>
<li><code>restart_after_crash</code></li>
<li><code>restore_command</code></li>
<li><code>shared_preload_libraries</code></li>
<li><code>ssl</code></li>
<li><code>ssl_ca_file</code></li>
<li><code>ssl_cert_file</code></li>
<li><code>ssl_ciphers</code></li>
<li><code>ssl_crl_file</code></li>
<li><code>ssl_dh_params_file</code></li>
<li><code>ssl_ecdh_curve</code></li>
<li><code>ssl_key_file</code></li>
<li><code>ssl_max_protocol_version</code></li>
<li><code>ssl_min_protocol_version</code></li>
<li><code>ssl_passphrase_command</code></li>
<li><code>ssl_passphrase_command_supports_reload</code></li>
<li><code>ssl_prefer_server_ciphers</code></li>
<li><code>stats_temp_directory</code></li>
<li><code>synchronous_standby_names</code></li>
<li><code>syslog_facility</code></li>
<li><code>syslog_ident</code></li>
<li><code>syslog_sequence_numbers</code></li>
<li><code>syslog_split_messages</code></li>
<li><code>unix_socket_directories</code></li>
<li><code>unix_socket_group</code></li>
<li><code>unix_socket_permissions</code></li>
<li><code>wal_level</code></li>
<li><code>wal_log_hints</code></li>
</ul>



    <footer class="text-center p-24">
    <div>
        <a href="#" class="bg-rose-600 py-4 px-12 rounded-full text-white text-xl">View on GitHub</a>
    </div>
    <p class="text-sm text-slate-600 w-1/2 mx-auto pt-10">&copy; 2019-2022 The CloudNativePG Contributors<br/>
    The Linux Foundation has registered trademarks and uses trademarks. 
    For a list of trademarks of The Linux Foundation, please see our <a href="https://www.linuxfoundation.org/trademark-usage/" class="text-rose-600">Trademark Usage page</a>.<br/>
    Postgres, PostgreSQL and the Slonik Logo are trademarks or registered trademarks of the PostgreSQL Community Association of Canada, and used with their permission.
    </p>
</footer>

  </div>
  
  <script src="https://cdn.usefathom.com/script.js" data-site="GSMQCVAJ" defer></script>
  
</body>

</html>
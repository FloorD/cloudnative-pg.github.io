<!DOCTYPE html>




<html lang="en">

<head>
  <title>CloudNative PG</title>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta http-equiv="X-UA-Compatible" content="ie=edge" />
  <meta name="description" content="CloudNativePG is the Kubernetes operator that covers the full lifecycle of a highly available PostgreSQL database cluster with a primary/standby architecture, using native streaming replication." />
  <meta name="keywords" content="" />
  <link rel="preload" href="/css/Supreme-Variable.woff2" as="font" type="font/woff2" crossorigin="anonymous" />
  <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,700" rel="stylesheet" />
  <link href="/main.min.css" rel="stylesheet" />
  <link rel="favicon" href="/favicon/favicon.ico">
  <script async defer src="https://buttons.github.io/buttons.js"></script>
</head>

<body>
  <div class="h-screen w-screen">
    
<main>
  <header>
    <div class="flex flex-row px-16 justify-between py-5">
      <div>
        
        <a href="/"><img src="/logo/large_logo.svg" class="h-14" alt="Cloud Native Postgres Logo"></a>
      </div>
      <div>
        <ul class="flex gap-14 text-2xl medium-gray my-5">
          <li><a href="/docs/1.15.0/" target="_blank">Documentation</a></li>
          <li>Blog</li>
          <li><a href="/support">Support</a></li>
          <li><a href="/end_users">End Users</a></li>
        </ul>
      </div>
      <div class="flex gap-5 my-4 fill-cnp-blue">
       <a class="github-button" href="https://github.com/cloudnative-pg/cloudnative-pg"
            data-color-scheme="no-preference: light; light: light; dark: dark;"
            data-size="large" data-show-count="true"
            aria-label="Star cloudnative-pg/cloudnative-pg on GitHub">Star</a>
        <a href="https://join.slack.com/t/cloudnativepg/shared_invite/zt-17culux7k-P_UsVOOR9teUYi4dGhDSBQ">
          <img src="/icons/Slack.svg" alt="Slack" title="Join our Slack channel now!">
        </a>
        <a href="https://twitter.com/CloudNativePg">
          <img src="/icons/Twitter.svg" alt="Twitter">
        </a>
        <a href="https://www.youtube.com/channel/UCTGH88W1BiuRRPTzJUDPJyA">
          <img src="/icons/YouTube.svg" alt="YouTube">
        </a>
      </div>
    </div>
  </header>
</main>


    
<base href="..">
<div class="px-56 pt-20 flex">
    <div class="w-1/4 px-5 bg-purple-2 pt-14 leading-9">
        
<ul>
    
    
    
    
    <li>
        <a href="/docs/v1.15.0/api_reference/">API Reference</a>
    </li>
    
    
    
    <li>
        <a href="/docs/v1.15.0/applications/">Connecting from an application</a>
    </li>
    
    
    
    <li>
        <a href="/docs/v1.15.0/architecture/">Architecture</a>
    </li>
    
    
    
    <li>
        <a href="/docs/v1.15.0/backup_recovery/">Backup and Recovery</a>
    </li>
    
    
    
    <li>
        <a href="/docs/v1.15.0/before_you_start/">Before You Start</a>
    </li>
    
    
    
    <li>
        <a href="/docs/v1.15.0/bootstrap/">Bootstrap</a>
    </li>
    
    
    
    <li>
        <a href="/docs/v1.15.0/certificates/">Certificates</a>
    </li>
    
    
    
    <li>
        <a href="/docs/v1.15.0/cnpg-plugin/">CloudNativePG Plugin</a>
    </li>
    
    
    
    <li>
        <a href="/docs/v1.15.0/commercial_support/">Commercial support</a>
    </li>
    
    
    
    <li>
        <a href="/docs/v1.15.0/connection_pooling/">Connection Pooling</a>
    </li>
    
    
    
    <li>
        <a href="/docs/v1.15.0/container_images/">Container Image Requirements</a>
    </li>
    
    
    
    <li>
        <a href="/docs/v1.15.0/e2e/">End-to-End Tests</a>
    </li>
    
    
    
    <li>
        <a href="/docs/v1.15.0/expose_pg_services/">Exposing Postgres Services</a>
    </li>
    
    
    
    <li>
        <a href="/docs/v1.15.0/failover/">Automated failover</a>
    </li>
    
    
    
    <li>
        <a href="/docs/v1.15.0/failure_modes/">Failure Modes</a>
    </li>
    
    
    
    <li>
        <a href="/docs/v1.15.0/fencing/">Fencing</a>
    </li>
    
    
    
    <li>
        <a href="/docs/v1.15.0/installation_upgrade/">Installation and upgrades</a>
    </li>
    
    
    
    <li>
        <a href="/docs/v1.15.0/instance_manager/">Postgres instance manager</a>
    </li>
    
    
    
    <li>
        <a href="/docs/v1.15.0/kubernetes_upgrade/">Kubernetes Upgrade</a>
    </li>
    
    
    
    <li>
        <a href="/docs/v1.15.0/labels_annotations/">Labels and annotations</a>
    </li>
    
    
    
    <li>
        <a href="/docs/v1.15.0/logging/">Logging</a>
    </li>
    
    
    
    <li>
        <a href="/docs/v1.15.0/monitoring/">Monitoring</a>
    </li>
    
    
    
    <li>
        <a href="/docs/v1.15.0/operator_capability_levels/">Operator Capability Levels</a>
    </li>
    
    
    
    <li>
        <a href="/docs/v1.15.0/operator_conf/">Operator configuration</a>
    </li>
    
    
    
    <li>
        <a href="/docs/v1.15.0/postgresql_conf/">PostgreSQL Configuration</a>
    </li>
    
    
    
    <li>
        <a href="/docs/v1.15.0/quickstart/">Quickstart</a>
    </li>
    
    
    
    <li>
        <a href="/docs/v1.15.0/release_notes/">Release notes</a>
    </li>
    
    
    
    <li>
        <a href="/docs/v1.15.0/replication/">Replication</a>
    </li>
    
    
    
    <li>
        <a href="/docs/v1.15.0/resource_management/">Resource management</a>
    </li>
    
    
    
    <li>
        <a href="/docs/v1.15.0/rolling_update/">Rolling Updates</a>
    </li>
    
    
    
    <li>
        <a href="/docs/v1.15.0/samples/">Configuration Samples</a>
    </li>
    
    
    
    <li>
        <a href="/docs/v1.15.0/scheduling/">Scheduling</a>
    </li>
    
    
    
    <li>
        <a href="/docs/v1.15.0/security/">Security</a>
    </li>
    
    
    
    <li>
        <a href="/docs/v1.15.0/ssl_connections/">Client TLS/SSL Connections</a>
    </li>
    
    
    
    <li>
        <a href="/docs/v1.15.0/storage/">Storage</a>
    </li>
    
    
    
    <li>
        <a href="/docs/v1.15.0/supported_releases/">Supported releases</a>
    </li>
    
    
    
    <li>
        <a href="/docs/v1.15.0/troubleshooting/">Troubleshooting</a>
    </li>
    
    
    
    <li>
        <a href="/docs/v1.15.0/use_cases/">Use cases</a>
    </li>
    
    
    
</ul>

<hr class="w-1/2">


<p>Documention by version</p>
<ul>
    
    <li>
        <a href="/docs/v1.15.0/">
            CloudNativePG
            v1.15.0
        </a>
    </li>
    
</ul>

    </div>
    <div class="w-4/6 pr-20 ml-10 well">
        <p><h1 id="automated-failover">Automated failover</h1>
<p>In the case of unexpected errors on the primary, the cluster will go into
<strong>failover mode</strong>. This may happen, for example, when:</p>
<ul>
<li>The primary pod has a disk failure</li>
<li>The primary pod is deleted</li>
<li>The <code>postgres</code> container on the primary has any kind of sustained failure</li>
</ul>
<p>In the failover scenario, the primary cannot be assumed to be working properly.</p>
<p>After cases like the ones above, the readiness probe for the primary pod will start
failing. This will be picked up in the controller&rsquo;s reconciliation loop. The
controller will initiate the failover process, in two steps:</p>
<ol>
<li>First, it will mark the <code>TargetPrimary</code> as <code>pending</code>. This change of state will
force the primary pod to shutdown, to ensure the WAL receivers on the replicas
will stop. The cluster will be marked in failover phase (&ldquo;Failing over&rdquo;).</li>
<li>Once all WAL receivers are stopped, there will be a leader election, and a
new primary will be named. The chosen instance will initiate promotion to
primary, and, after this is completed, the cluster will resume normal operations.
Meanwhile, the former primary pod will restart, detect that it is no longer
the primary, and become a replica node.</li>
</ol>
<p>!!! Important
The two-phase procedure helps ensure the WAL receivers can stop in an orderly
fashion, and that the failing primary will not start streaming WALs again upon
restart. These safeguards prevent timeline discrepancies between the new primary
and the replicas.</p>
<p>During the time the failing primary is being shut down:</p>
<ol>
<li>It will first try a PostgreSQL&rsquo;s <em>fast shutdown</em> with
<code>.spec.switchoverDelay</code> seconds as timeout. This graceful shutdown will attempt
to archive pending WALs.</li>
<li>If the fast shutdown fails, or its timeout is exceeded, a PostgreSQL&rsquo;s
<em>immediate shutdown</em> is initiated.</li>
</ol>
<p>!!! Info
&ldquo;Fast&rdquo; mode does not wait for PostgreSQL clients to disconnect and will
terminate an online backup in progress. All active transactions are rolled back
and clients are forcibly disconnected, then the server is shut down.
&ldquo;Immediate&rdquo; mode will abort all PostgreSQL server processes immediately,
without a clean shutdown.</p>
<h2 id="rto-and-rpo-impact">RTO and RPO impact</h2>
<p>Failover may result in the service being impacted and/or data being lost:</p>
<ol>
<li>During the time when the primary has started to fail, and before the controller
starts failover procedures, queries in transit, WAL writes, checkpoints and
similar operations, may fail.</li>
<li>Once the fast shutdown command has been issued, the cluster will no longer
accept connections, so service will be impacted but no data
will be lost.</li>
<li>If the fast shutdown fails, the immediate shutdown will stop any pending
processes, including WAL writing. Data may be lost.</li>
<li>During the time the primary is shutting down and a new primary hasn&rsquo;t yet
started, the cluster will operate without a primary and thus be impaired - but
with no data loss.</li>
</ol>
<p>!!! Note
The timeout that controls fast shutdown is set by <code>.spec.switchoverDelay</code>,
as in the case of a switchover. Increasing the time for fast shutdown is safer
from an RPO point of view, but possibly delays the return to normal operation -
negatively affecting RTO.</p>
<p>!!! Warning
As already mentioned in the <a href="instance_manager.md">&ldquo;Instance Manager&rdquo; section</a>
when explaining the switchover process, the <code>.spec.switchoverDelay</code> option
affects the RPO and RTO of your PostgreSQL database. Setting it to a low value,
might favor RTO over RPO but lead to data loss at cluster level and/or backup
level. On the contrary, setting it to a high value, might remove the risk of
data loss while leaving the cluster without an active primary for a longer time
during the switchover.</p>
</p>
    </div>
</div>


    <footer class="text-center pb-24">
    <p class="text-sm charcoal w-1/2 mx-auto pt-10">&copy; 2019-2022 The CloudNativePG Contributors. All rights
        reserved. The Linux Foundation has registered trademarks and uses trademarks.
        For a list of trademarks of The Linux Foundation, please see our <a href="#" class="red-1">Trademark Usage
            page</a>.</p>
</footer>
  </div>
  
  <script src="https://cdn.usefathom.com/script.js" data-site="GSMQCVAJ" defer></script>
  
</body>

</html>

<!DOCTYPE html>




<html lang="en">

<head>
  <title>CloudNative PG</title>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta http-equiv="X-UA-Compatible" content="ie=edge" />
  <meta name="description" content="CloudNativePG is the Kubernetes operator that covers the full lifecycle of a highly available PostgreSQL database cluster with a primary/standby architecture, using native streaming replication." />
  <meta name="keywords" content="" />
  <link rel="preload" href="/css/Supreme-Variable.woff2" as="font" type="font/woff2" crossorigin="anonymous" />
  <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,700" rel="stylesheet" />
  <link href="/main.min.css" rel="stylesheet" />
  <link rel="favicon" href="/favicon/favicon.ico">
  <script async defer src="https://buttons.github.io/buttons.js"></script>
</head>

<body>
  <div class="h-screen w-screen">
    
<main>
  <header>
    <div class="md:flex md:flex-row md:px-16 md:justify-between py-5">
      <div class="flex justify-between px-4 md:hidden">
        <div>
          
          <a href="/"><img src="/logo/large_logo.svg" class="md:h-14 h-9" alt="Cloud Native Postgres Logo"></a>
        </div>
        <div class="h-6 my-auto" id="toggle-button">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h16M4 18h16" />
          </svg>
        </div>
      </div>
      <div class="md:block hidden">
        
        <a href="/"><img src="/logo/large_logo.svg" class="h-14" alt="Cloud Native Postgres Logo"></a>
      </div>
      
      <div class="hidden md:block">
        <ul class="md:flex gap-14 text-2xl medium-gray my-5">
          <li><a href="/docs/1.15.0/" target="_blank">Documentation</a></li>
          <li>Blog</li>
          <li><a href="/support">Support</a></li>
          <li><a href="/end_users">End Users</a></li>
        </ul>
      </div>
      
      <div class="py-4 bg-gray-1 mt-5 hidden" id="navi-list">
        <ul class="md:flex gap-14 text-2xl md:medium-gray charcoal">
          <li class="text-center py-4"><a href="/docs">Documentation</a></li>
          <li class="text-center py-4"><a href="/blog">Blog</a></li>
          <li class="text-center py-4"><a href="/support">Support</a></li>
          <li class="text-center py-4"><a href="/end_users">End Users</a></li>
        </ul>
        <div class="flex gap-3 py-4 justify-center bg-gray-1 fill-cnp-blue">
          <a href="https://github.com/cloudnative-pg/cloudnative-pg">
            <img src="/icons/Git.svg" alt="Github">
          </a>
          <a href="https://cloudnativepg.slack.com/">
            <img src="/icons/Slack.svg" alt="Slack">
          </a>
          <a href="https://twitter.com/CloudNativePg">
            <img src="/icons/Twitter.svg" alt="Twitter">
          </a>
          <a href="https://www.youtube.com/channel/UCTGH88W1BiuRRPTzJUDPJyA">
            <img src="/icons/YouTube.svg" alt="YouTube">
          </a>
        </div>
      </div>
      

      <div class="flex gap-5 my-4 fill-cnp-blue hidden md:flex">
       <a class="github-button" href="https://github.com/cloudnative-pg/cloudnative-pg"
            data-color-scheme="no-preference: light; light: light; dark: dark;"
            data-size="large" data-show-count="true"
            aria-label="Star cloudnative-pg/cloudnative-pg on GitHub">Star</a>
        <a href="https://join.slack.com/t/cloudnativepg/shared_invite/zt-17culux7k-P_UsVOOR9teUYi4dGhDSBQ">
          <img src="/icons/Slack.svg" alt="Slack" title="Join our Slack channel now!">
        </a>
        <a href="https://twitter.com/CloudNativePg">
          <img src="/icons/Twitter.svg" alt="Twitter">
        </a>
        <a href="https://www.youtube.com/channel/UCTGH88W1BiuRRPTzJUDPJyA">
          <img src="/icons/YouTube.svg" alt="YouTube">
        </a>
      </div>
    </div>
  </header>
</main>
<script>
  const toggleButton = document.getElementById('toggle-button')
  const naviList = document.getElementById('navi-list')

  toggleButton.addEventListener('click', () => {
    naviList.classList.toggle('hidden');
  })
</script>


    
<base href="..">
<div class="px-56 pt-20 flex">
    <div class="w-1/4 px-5 bg-purple-2 pt-14 leading-9">
        
<ul>
    
    
    
    
    <li>
        <a href="/docs/v1.15.0/api_reference/">API Reference</a>
    </li>
    
    
    
    <li>
        <a href="/docs/v1.15.0/applications/">Connecting from an application</a>
    </li>
    
    
    
    <li>
        <a href="/docs/v1.15.0/architecture/">Architecture</a>
    </li>
    
    
    
    <li>
        <a href="/docs/v1.15.0/backup_recovery/">Backup and Recovery</a>
    </li>
    
    
    
    <li>
        <a href="/docs/v1.15.0/before_you_start/">Before You Start</a>
    </li>
    
    
    
    <li>
        <a href="/docs/v1.15.0/bootstrap/">Bootstrap</a>
    </li>
    
    
    
    <li>
        <a href="/docs/v1.15.0/certificates/">Certificates</a>
    </li>
    
    
    
    <li>
        <a href="/docs/v1.15.0/cnpg-plugin/">CloudNativePG Plugin</a>
    </li>
    
    
    
    <li>
        <a href="/docs/v1.15.0/commercial_support/">Commercial support</a>
    </li>
    
    
    
    <li>
        <a href="/docs/v1.15.0/connection_pooling/">Connection Pooling</a>
    </li>
    
    
    
    <li>
        <a href="/docs/v1.15.0/container_images/">Container Image Requirements</a>
    </li>
    
    
    
    <li>
        <a href="/docs/v1.15.0/e2e/">End-to-End Tests</a>
    </li>
    
    
    
    <li>
        <a href="/docs/v1.15.0/expose_pg_services/">Exposing Postgres Services</a>
    </li>
    
    
    
    <li>
        <a href="/docs/v1.15.0/failover/">Automated failover</a>
    </li>
    
    
    
    <li>
        <a href="/docs/v1.15.0/failure_modes/">Failure Modes</a>
    </li>
    
    
    
    <li>
        <a href="/docs/v1.15.0/fencing/">Fencing</a>
    </li>
    
    
    
    <li>
        <a href="/docs/v1.15.0/installation_upgrade/">Installation and upgrades</a>
    </li>
    
    
    
    <li>
        <a href="/docs/v1.15.0/instance_manager/">Postgres instance manager</a>
    </li>
    
    
    
    <li>
        <a href="/docs/v1.15.0/kubernetes_upgrade/">Kubernetes Upgrade</a>
    </li>
    
    
    
    <li>
        <a href="/docs/v1.15.0/labels_annotations/">Labels and annotations</a>
    </li>
    
    
    
    <li>
        <a href="/docs/v1.15.0/logging/">Logging</a>
    </li>
    
    
    
    <li>
        <a href="/docs/v1.15.0/monitoring/">Monitoring</a>
    </li>
    
    
    
    <li>
        <a href="/docs/v1.15.0/operator_capability_levels/">Operator Capability Levels</a>
    </li>
    
    
    
    <li>
        <a href="/docs/v1.15.0/operator_conf/">Operator configuration</a>
    </li>
    
    
    
    <li>
        <a href="/docs/v1.15.0/postgresql_conf/">PostgreSQL Configuration</a>
    </li>
    
    
    
    <li>
        <a href="/docs/v1.15.0/quickstart/">Quickstart</a>
    </li>
    
    
    
    <li>
        <a href="/docs/v1.15.0/release_notes/">Release notes</a>
    </li>
    
    
    
    <li>
        <a href="/docs/v1.15.0/replication/">Replication</a>
    </li>
    
    
    
    <li>
        <a href="/docs/v1.15.0/resource_management/">Resource management</a>
    </li>
    
    
    
    <li>
        <a href="/docs/v1.15.0/rolling_update/">Rolling Updates</a>
    </li>
    
    
    
    <li>
        <a href="/docs/v1.15.0/samples/">Configuration Samples</a>
    </li>
    
    
    
    <li>
        <a href="/docs/v1.15.0/scheduling/">Scheduling</a>
    </li>
    
    
    
    <li>
        <a href="/docs/v1.15.0/security/">Security</a>
    </li>
    
    
    
    <li>
        <a href="/docs/v1.15.0/ssl_connections/">Client TLS/SSL Connections</a>
    </li>
    
    
    
    <li>
        <a href="/docs/v1.15.0/storage/">Storage</a>
    </li>
    
    
    
    <li>
        <a href="/docs/v1.15.0/supported_releases/">Supported releases</a>
    </li>
    
    
    
    <li>
        <a href="/docs/v1.15.0/troubleshooting/">Troubleshooting</a>
    </li>
    
    
    
    <li>
        <a href="/docs/v1.15.0/use_cases/">Use cases</a>
    </li>
    
    
    
</ul>

<hr class="w-1/2">


<p>Documention by version</p>
<ul>
    
    <li>
        <a href="/docs/v1.15.0/">
            CloudNativePG
            v1.15.0
        </a>
    </li>
    
</ul>

    </div>
    <div class="w-4/6 pr-20 ml-10 well">
        <p><h1 id="operator-configuration">Operator configuration</h1>
<p>The operator for CloudNativePG is installed from a standard
deployment manifest and follows the convention over configuration paradigm.
While this is fine in most cases, there are some scenarios where you want
to change the default behavior, such as:</p>
<ul>
<li>defining annotations and labels to be inherited by all resources created
by the operator and that are set in the cluster resource</li>
<li>defining a different default image for PostgreSQL or an additional pull secret</li>
</ul>
<p>By default, the operator is installed in the <code>cnpg-system</code>
namespace as a Kubernetes <code>Deployment</code> called <code>cnpg-controller-manager</code>.</p>
<p>!!! Note
In the examples below we assume the default name and namespace for the operator deployment.</p>
<p>The behavior of the operator can be customized through a <code>ConfigMap</code>/<code>Secret</code> that
is located in the same namespace of the operator deployment and with
<code>cnpg-controller-manager-config</code> as the name.</p>
<p>!!! Important
Any change to the config&rsquo;s <code>ConfigMap</code>/<code>Secret</code> will not be automatically
detected by the operator, - and as such, it needs to be reloaded (see below).
Moreover, changes only apply to the resources created after the configuration
is reloaded.</p>
<p>!!! Important
The operator first processes the ConfigMap values and then the Secret’s, in this order.
As a result, if a parameter is defined in both places, the one in the Secret will be used.</p>
<h2 id="available-options">Available options</h2>
<p>The operator looks for the following environment variables to be defined in the <code>ConfigMap</code>/<code>Secret</code>:</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>INHERITED_ANNOTATIONS</code></td>
<td>list of annotation names that, when defined in a <code>Cluster</code> metadata, will be inherited by all the generated resources, including pods</td>
</tr>
<tr>
<td><code>INHERITED_LABELS</code></td>
<td>list of label names that, when defined in a <code>Cluster</code> metadata, will be inherited by all the generated resources, including pods</td>
</tr>
<tr>
<td><code>PULL_SECRET_NAME</code></td>
<td>name of an additional pull secret to be defined in the operator&rsquo;s namespace and to be used to download images</td>
</tr>
<tr>
<td><code>ENABLE_AZURE_PVC_UPDATES</code></td>
<td>Enables to delete Postgres pod if its PVC is stuck in Resizing condition. This feature is mainly for the Azure environment (default <code>false</code>)</td>
</tr>
<tr>
<td><code>ENABLE_INSTANCE_MANAGER_INPLACE_UPDATES</code></td>
<td>when set to <code>true</code>, enables in-place updates of the instance manager after an update of the operator, avoiding rolling updates of the cluster (default <code>false</code>)</td>
</tr>
<tr>
<td><code>MONITORING_QUERIES_CONFIGMAP</code></td>
<td>The name of a ConfigMap in the operator&rsquo;s namespace with a set of default queries (to be specified under the key <code>queries</code>) to be applied to all created Clusters</td>
</tr>
<tr>
<td><code>MONITORING_QUERIES_SECRET</code></td>
<td>The name of a Secret in the operator&rsquo;s namespace with a set of default queries (to be specified under the key <code>queries</code>) to be applied to all created Clusters</td>
</tr>
</tbody>
</table>
<p>Values in <code>INHERITED_ANNOTATIONS</code> and <code>INHERITED_LABELS</code> support path-like wildcards. For example, the value <code>example.com/*</code> will match
both the value <code>example.com/one</code> and <code>example.com/two</code>.</p>
<p>When you specify an additional pull secret name using the <code>PULL_SECRET_NAME</code> parameter,
the operator will use that secret to create a pull secret for every created PostgreSQL
cluster. That secret will be named <code>&lt;cluster-name&gt;-pull</code>.</p>
<p>The namespace where the operator looks for the <code>PULL_SECRET_NAME</code> secret is where
you installed the operator. If the operator is not able to find that secret, it
will ignore the configuration parameter.</p>
<p>!!! Warning
Previous versions of the operator copied the <code>PULL_SECRET_NAME</code> secret inside
the namespaces where you deploy the PostgreSQL clusters. From version &ldquo;1.11.0&rdquo;
the behavior changed to match the previous description. The pull secrets
created by the previous versions of the operator are unused.</p>
<h2 id="defining-an-operator-config-map">Defining an operator config map</h2>
<p>The example below customizes the behavior of the operator, by defining
the label/annotation names to be inherited by the resources created by
any <code>Cluster</code> object that is deployed at a later time, and by enabling
<a href="installation_upgrade.md#in-place-updates-of-the-instance-manager">in-place updates for the instance
manager</a>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">ConfigMap</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">cnpg-controller-manager-config</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">cnpg-system</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">data</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">INHERITED_ANNOTATIONS</span>: <span style="color:#ae81ff">categories</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">INHERITED_LABELS</span>: <span style="color:#ae81ff">environment, workload, app</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">ENABLE_INSTANCE_MANAGER_INPLACE_UPDATES</span>: <span style="color:#e6db74">&#39;true&#39;</span>
</span></span></code></pre></div><h2 id="defining-an-operator-secret">Defining an operator secret</h2>
<p>The example below customizes the behavior of the operator, by defining
the label/annotation names to be inherited by the resources created by
any <code>Cluster</code> object that is deployed at a later time, and by enabling
<a href="installation_upgrade.md#in-place-updates-of-the-instance-manager">in-place updates for the instance
manager</a>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Secret</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">cnpg-controller-manager-config</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">cnpg-system</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">type</span>: <span style="color:#ae81ff">Opaque</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">stringData</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">INHERITED_ANNOTATIONS</span>: <span style="color:#ae81ff">categories</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">INHERITED_LABELS</span>: <span style="color:#ae81ff">environment, workload, app</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">ENABLE_INSTANCE_MANAGER_INPLACE_UPDATES</span>: <span style="color:#e6db74">&#39;true&#39;</span>
</span></span></code></pre></div><h2 id="restarting-the-operator-to-reload-configs">Restarting the operator to reload configs</h2>
<p>For the change to be effective, you need to recreate the operator pods to
reload the config map. If you have installed the operator on Kubernetes
using the manifest you can do that by issuing:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>kubectl rollout restart deployment <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    -n cnpg-system <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    cnpg-controller-manager
</span></span></code></pre></div><p>In general, given a specific namespace, you can delete the operator pods with
the following command:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>kubectl delete pods -n <span style="color:#f92672">[</span>NAMESPACE_NAME_HERE<span style="color:#f92672">]</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  -l app.kubernetes.io/name<span style="color:#f92672">=</span>cloudnative-pg
</span></span></code></pre></div><p>!!! Warning
Customizations will be applied only to <code>Cluster</code> resources created
after the reload of the operator deployment.</p>
<p>Following the above example, if the <code>Cluster</code> definition contains a <code>categories</code>
annotation and any of the <code>environment</code>, <code>workload</code>, or <code>app</code> labels, these will
be inherited by all the resources generated by the deployment.</p>
<h2 id="pprof-http-server">PPROF HTTP SERVER</h2>
<p>The operator can expose a PPROF HTTP server with the following endpoints on localhost:6060:</p>
<pre tabindex="0"><code>- `/debug/pprof/`. Responds to a request for &#34;/debug/pprof/&#34; with an HTML page listing the available profiles
- `/debug/pprof/cmdline`. Responds with the running program&#39;s command line, with arguments separated by NUL bytes.
- `/debug/pprof/profile`. Responds with the pprof-formatted cpu profile. Profiling lasts for duration specified in seconds GET parameter, or for 30 seconds if not specified.
- `/debug/pprof/symbol`. Looks up the program counters listed in the request, responding with a table mapping program counters to function names.
- `/debug/pprof/trace`. Responds with the execution trace in binary form.  Tracing lasts for duration specified in seconds GET parameter, or for 1 second if not specified.
</code></pre><p>To enable the operator you need to edit the operator deployment add the flag <code>--pprof-server=true</code>.</p>
<p>You can do this by executing these commands:</p>
<pre tabindex="0"><code>kubectl edit deployment -n cnpg-system cnpg-controller-manager
</code></pre><p>Then on the edit page scroll down the container args and add <code>--pprof-server=true</code>, example:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span>      <span style="color:#f92672">containers</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">args</span>:
</span></span><span style="display:flex;"><span>        - <span style="color:#ae81ff">controller</span>
</span></span><span style="display:flex;"><span>        - --<span style="color:#ae81ff">enable-leader-election</span>
</span></span><span style="display:flex;"><span>        - --<span style="color:#ae81ff">config-map-name=cnpg-controller-manager-config</span>
</span></span><span style="display:flex;"><span>        - --<span style="color:#ae81ff">secret-name=cnpg-controller-manager-config</span>
</span></span><span style="display:flex;"><span>        - --<span style="color:#ae81ff">log-level=info</span>
</span></span><span style="display:flex;"><span>        - --<span style="color:#ae81ff">pprof-server=true</span> <span style="color:#75715e"># relevant line</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">command</span>:
</span></span><span style="display:flex;"><span>        - <span style="color:#ae81ff">/manager</span>
</span></span></code></pre></div><p>Save the changes, the deployment now will execute a rollout and the new pod will have the PPROF server enabled.</p>
<p>Once the pod is running you can exec inside the container by doing:</p>
<pre tabindex="0"><code>kubectl exec -ti -n cnpg-system &lt;pod name&gt; -- bash
</code></pre><p>Once inside execute:</p>
<pre tabindex="0"><code>curl localhost:6060/debug/pprof/
</code></pre></p>
    </div>
</div>


    <footer class="text-center pb-24">
    <p class="text-sm charcoal md:w-1/2 mx-auto md:pt-10 px-6 pt-12">&copy; 2019-2022 The CloudNativePG Contributors. All rights
        reserved. The Linux Foundation has registered trademarks and uses trademarks.
        For a list of trademarks of The Linux Foundation, please see our <a href="#" class="red-1">Trademark Usage
            page</a>.</p>
</footer>
  </div>
  
  <script src="https://cdn.usefathom.com/script.js" data-site="GSMQCVAJ" defer></script>
  
</body>

</html>
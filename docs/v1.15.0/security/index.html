<!DOCTYPE html>




<html lang="en">

<head>
  <title>CloudNative PG</title>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta http-equiv="X-UA-Compatible" content="ie=edge" />
  <meta name="description" content="CloudNativePG is the Kubernetes operator that covers the full lifecycle of a highly available PostgreSQL database cluster with a primary/standby architecture, using native streaming replication." />
  <meta name="keywords" content="" />
  <link rel="preload" href="/css/Supreme-Variable.woff2" as="font" type="font/woff2" crossorigin="anonymous" />
  <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,700" rel="stylesheet" />
  <link href="/main.min.css" rel="stylesheet" />
  <link rel="favicon" href="/favicon/favicon.ico">
  <script async defer src="https://buttons.github.io/buttons.js"></script>
</head>

<body>
  <div class="h-screen w-screen">
    
<main>
  <header>
    <div class="md:flex md:flex-row md:px-16 md:justify-between py-5">
      <div class="flex justify-between px-4 md:hidden">
        <div>
          
          <a href="/"><img src="/logo/large_logo.svg" class="md:h-14 h-9" alt="Cloud Native Postgres Logo"></a>
        </div>
        <div class="h-6 my-auto" id="toggle-button">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h16M4 18h16" />
          </svg>
        </div>
      </div>
      <div class="md:block hidden">
        
        <a href="/"><img src="/logo/large_logo.svg" class="h-14" alt="Cloud Native Postgres Logo"></a>
      </div>
      
      <div class="hidden md:block">
        <ul class="md:flex gap-14 text-2xl medium-gray my-5">
          <li><a href="/docs/1.15.0">Documentation</a></li>
          <li><a href="/blog">Blog</a></li>
          <li><a href="/support">Support</a></li>
          <li><a href="/end_users">End Users</a></li>
        </ul>
      </div>
      
      <div class="py-4 bg-gray-1 mt-5 hidden" id="navi-list">
        <ul class="md:flex gap-14 text-2xl md:medium-gray charcoal">
          <li class="text-center py-4"><a href="/docs">Documentation</a></li>
          <li class="text-center py-4"><a href="/blog">Blog</a></li>
          <li class="text-center py-4"><a href="/support">Support</a></li>
          <li class="text-center py-4"><a href="/end_users">End Users</a></li>
        </ul>
        <div class="flex gap-3 py-4 justify-center bg-gray-1 fill-cnp-blue">
          <a href="https://github.com/cloudnative-pg/cloudnative-pg">
            <img src="/icons/Git.svg" alt="Github">
          </a>
          <a href="https://cloudnativepg.slack.com/">
            <img src="/icons/Slack.svg" alt="Slack">
          </a>
          <a href="https://twitter.com/CloudNativePg">
            <img src="/icons/Twitter.svg" alt="Twitter">
          </a>
          <a href="https://www.youtube.com/channel/UCTGH88W1BiuRRPTzJUDPJyA">
            <img src="/icons/YouTube.svg" alt="YouTube">
          </a>
        </div>
      </div>
      

      <div class="flex gap-5 my-4 fill-cnp-blue hidden md:flex">
       <a class="github-button" href="https://github.com/cloudnative-pg/cloudnative-pg"
            data-color-scheme="no-preference: light; light: light; dark: dark;"
            data-size="large" data-show-count="true"
            aria-label="Star cloudnative-pg/cloudnative-pg on GitHub">Star</a>
        <a href="https://join.slack.com/t/cloudnativepg/shared_invite/zt-17culux7k-P_UsVOOR9teUYi4dGhDSBQ">
          <img src="/icons/Slack.svg" alt="Slack" title="Join our Slack channel now!">
        </a>
        <a href="https://twitter.com/CloudNativePg">
          <img src="/icons/Twitter.svg" alt="Twitter">
        </a>
        <a href="https://www.youtube.com/channel/UCTGH88W1BiuRRPTzJUDPJyA">
          <img src="/icons/YouTube.svg" alt="YouTube">
        </a>
      </div>
    </div>
  </header>
</main>
<script>
  const toggleButton = document.getElementById('toggle-button')
  const naviList = document.getElementById('navi-list')

  toggleButton.addEventListener('click', () => {
    naviList.classList.toggle('hidden');
  })
</script>


    
<base href="..">
<div class="md:px-56 md:pt-20 md:flex">
    <div class="w-1/4 px-4 bg-purple-2 pt-14 leading-9 md:block hidden">
        
<ul>
    
    
    
    
    <li>
        <a href="/docs/v1.15.0/api_reference/">API Reference</a>
    </li>
    
    
    
    <li>
        <a href="/docs/v1.15.0/applications/">Connecting from an application</a>
    </li>
    
    
    
    <li>
        <a href="/docs/v1.15.0/architecture/">Architecture</a>
    </li>
    
    
    
    <li>
        <a href="/docs/v1.15.0/backup_recovery/">Backup and Recovery</a>
    </li>
    
    
    
    <li>
        <a href="/docs/v1.15.0/before_you_start/">Before You Start</a>
    </li>
    
    
    
    <li>
        <a href="/docs/v1.15.0/bootstrap/">Bootstrap</a>
    </li>
    
    
    
    <li>
        <a href="/docs/v1.15.0/certificates/">Certificates</a>
    </li>
    
    
    
    <li>
        <a href="/docs/v1.15.0/cnpg-plugin/">CloudNativePG Plugin</a>
    </li>
    
    
    
    <li>
        <a href="/docs/v1.15.0/commercial_support/">Commercial support</a>
    </li>
    
    
    
    <li>
        <a href="/docs/v1.15.0/connection_pooling/">Connection Pooling</a>
    </li>
    
    
    
    <li>
        <a href="/docs/v1.15.0/container_images/">Container Image Requirements</a>
    </li>
    
    
    
    <li>
        <a href="/docs/v1.15.0/e2e/">End-to-End Tests</a>
    </li>
    
    
    
    <li>
        <a href="/docs/v1.15.0/expose_pg_services/">Exposing Postgres Services</a>
    </li>
    
    
    
    <li>
        <a href="/docs/v1.15.0/failover/">Automated failover</a>
    </li>
    
    
    
    <li>
        <a href="/docs/v1.15.0/failure_modes/">Failure Modes</a>
    </li>
    
    
    
    <li>
        <a href="/docs/v1.15.0/fencing/">Fencing</a>
    </li>
    
    
    
    <li>
        <a href="/docs/v1.15.0/installation_upgrade/">Installation and upgrades</a>
    </li>
    
    
    
    <li>
        <a href="/docs/v1.15.0/instance_manager/">Postgres instance manager</a>
    </li>
    
    
    
    <li>
        <a href="/docs/v1.15.0/kubernetes_upgrade/">Kubernetes Upgrade</a>
    </li>
    
    
    
    <li>
        <a href="/docs/v1.15.0/labels_annotations/">Labels and annotations</a>
    </li>
    
    
    
    <li>
        <a href="/docs/v1.15.0/logging/">Logging</a>
    </li>
    
    
    
    <li>
        <a href="/docs/v1.15.0/monitoring/">Monitoring</a>
    </li>
    
    
    
    <li>
        <a href="/docs/v1.15.0/operator_capability_levels/">Operator Capability Levels</a>
    </li>
    
    
    
    <li>
        <a href="/docs/v1.15.0/operator_conf/">Operator configuration</a>
    </li>
    
    
    
    <li>
        <a href="/docs/v1.15.0/postgresql_conf/">PostgreSQL Configuration</a>
    </li>
    
    
    
    <li>
        <a href="/docs/v1.15.0/quickstart/">Quickstart</a>
    </li>
    
    
    
    <li>
        <a href="/docs/v1.15.0/release_notes/">Release notes</a>
    </li>
    
    
    
    <li>
        <a href="/docs/v1.15.0/replication/">Replication</a>
    </li>
    
    
    
    <li>
        <a href="/docs/v1.15.0/resource_management/">Resource management</a>
    </li>
    
    
    
    <li>
        <a href="/docs/v1.15.0/rolling_update/">Rolling Updates</a>
    </li>
    
    
    
    <li>
        <a href="/docs/v1.15.0/samples/">Configuration Samples</a>
    </li>
    
    
    
    <li>
        <a href="/docs/v1.15.0/scheduling/">Scheduling</a>
    </li>
    
    
    
    <li>
        <a href="/docs/v1.15.0/security/">Security</a>
    </li>
    
    
    
    <li>
        <a href="/docs/v1.15.0/ssl_connections/">Client TLS/SSL Connections</a>
    </li>
    
    
    
    <li>
        <a href="/docs/v1.15.0/storage/">Storage</a>
    </li>
    
    
    
    <li>
        <a href="/docs/v1.15.0/supported_releases/">Supported releases</a>
    </li>
    
    
    
    <li>
        <a href="/docs/v1.15.0/troubleshooting/">Troubleshooting</a>
    </li>
    
    
    
    <li>
        <a href="/docs/v1.15.0/use_cases/">Use cases</a>
    </li>
    
    
    
</ul>

<hr class="w-1/2">


<p>Documention by version</p>
<ul>
    
    <li>
        <a href="/docs/v1.15.0/">
            CloudNativePG
            v1.15.0
        </a>
    </li>
    
</ul>

    </div>
    <div class="w-4/6 pr-20 ml-10 well hidden md:block">
        <p><h1 id="security">Security</h1>
<p>This section contains information about security for CloudNativePG,
that are analyzed at 3 different layers: Code, Container and Cluster.</p>
<p>!!! Warning
The information contained in this page must not exonerate you from
performing regular InfoSec duties on your Kubernetes cluster. Please
familiarize yourself with the <a href="https://kubernetes.io/docs/concepts/security/overview/">&ldquo;Overview of Cloud Native Security&rdquo;</a>
page from the Kubernetes documentation.</p>
<p>!!! Seealso &ldquo;About the 4C&rsquo;s Security Model&rdquo;
Please refer to <a href="https://www.enterprisedb.com/blog/4cs-security-model-kubernetes">&ldquo;The 4Câ€™s Security Model in Kubernetes&rdquo;</a>
blog article to get a better understanding and context of the approach EDB
has taken with security in CloudNativePG.</p>
<h2 id="code">Code</h2>
<p>Source code of CloudNativePG is <em>systematically scanned</em> for static analysis purposes,
including <strong>security problems</strong>, using a popular open-source linter for Go called
<a href="https://github.com/golangci/golangci-lint">GolangCI-Lint</a> directly in the CI/CD pipeline.
GolangCI-Lint can run several <em>linters</em> on the same source code.</p>
<p>One of these is <a href="https://github.com/securego/gosec">Golang Security Checker</a>, or simply <code>gosec</code>,
a linter that scans the abstract syntactic tree of the source against a set of rules aimed at
the discovery of well-known vulnerabilities, threats, and weaknesses hidden in
the code such as hard-coded credentials, integer overflows and SQL injections - to name a few.</p>
<p>!!! Important
A failure in the static code analysis phase of the CI/CD pipeline is a blocker
for the entire delivery of CloudNativePG, meaning that each commit is validated
against all the linters defined by GolangCI-Lint.</p>
<h2 id="container">Container</h2>
<p>Every container image that is part of CloudNativePG is automatically built via CI/CD pipelines following every commit.
Such images include not only the operator&rsquo;s, but also the operands&rsquo; - specifically every supported PostgreSQL version.
Within the pipelines, images are scanned with:</p>
<ul>
<li><a href="https://github.com/goodwithtech/dockle">Dockle</a>: for best practices in terms
of the container build process</li>
</ul>
<p>!!! Important
All operand images are automatically rebuilt once a day by our pipelines in case
of security updates at the base image and package level, providing <strong>patch level updates</strong>
for the container images that EDB distributes.</p>
<p>The following guidelines and frameworks have been taken into account for container-level security:</p>
<ul>
<li>the <a href="https://dl.dod.cyber.mil/wp-content/uploads/devsecops/pdf/DevSecOps_Enterprise_Container_Image_Creation_and_Deployment_Guide_2.6-Public-Release.pdf">&ldquo;Container Image Creation and Deployment Guide&rdquo;</a>,
developed by the Defense Information Systems Agency (DISA) of the United States Department of Defense (DoD)</li>
<li>the <a href="https://www.cisecurity.org/benchmark/docker/">&ldquo;CIS Benchmark for Docker&rdquo;</a>,
developed by the Center for Internet Security (CIS)</li>
</ul>
<p>!!! Seealso &ldquo;About the Container level security&rdquo;
Please refer to <a href="https://www.enterprisedb.com/blog/security-and-containers-cloud-native-postgresql">&ldquo;Security and Containers in CloudNativePG&rdquo;</a>
blog article for more information about the approach that EDB has taken on
security at the container level in CloudNativePG.</p>
<h2 id="cluster">Cluster</h2>
<p>Security at the cluster level takes into account all Kubernetes components that
form both the control plane and the nodes, as well as the applications that run in
the cluster (PostgreSQL included).</p>
<h3 id="role-based-access-control-rbac">Role Based Access Control (RBAC)</h3>
<p>The operator interacts with the Kubernetes API server with a dedicated service
account called <code>cnpg-manager</code>. In Kubernetes this is installed
by default in the <code>cnpg-system</code> namespace, with a cluster role
binding between this service account and the <code>cnpg-manager</code>
cluster role which defines the set of rules/resources/verbs granted to the operator.</p>
<p>!!! Important
The above permissions are exclusively reserved for the operator&rsquo;s service
account to interact with the Kubernetes API server.  They are not directly
accessible by the users of the operator that interact only with <code>Cluster</code>,
<code>Pooler</code>, <code>Backup</code>, and <code>ScheduledBackup</code> resources.</p>
<p>Below we provide some examples and, most importantly, the reasons why
CloudNativePG requires full or partial management of standard Kubernetes
namespaced resources.</p>
<dl>
<dt><code>configmaps</code></dt>
<dd>The operator needs to create and manage default config maps for
the Prometheus exporter monitoring metrics.</dd>
<dt><code>deployments</code></dt>
<dd>The operator needs to manage a PgBouncer connection pooler
using a standard Kubernetes <code>Deployment</code> resource.</dd>
<dt><code>jobs</code></dt>
<dd>The operator needs to handle jobs to manage different <code>Cluster</code>&rsquo;s phases.</dd>
<dt><code>persistentvolumeclaims</code></dt>
<dd>The volume where the <code>PGDATA</code> resides is the
central element of a PostgreSQL <code>Cluster</code> resource; the operator needs
to interact with the selected storage class to dynamically provision
the requested volumes, based on the defined scheduling policies.</dd>
<dt><code>pods</code></dt>
<dd>The operator needs to manage <code>Cluster</code>&rsquo;s instances.</dd>
<dt><code>secrets</code></dt>
<dd>Unless you provide certificates and passwords to your <code>Cluster</code>
objects, the operator adopts the &ldquo;convention over configuration&rdquo; paradigm by
self-provisioning random generated passwords and TLS certificates, and by
storing them in secrets.</dd>
<dt><code>serviceaccounts</code></dt>
<dd>The operator needs to create a service account that
enables the instance manager (which is the <em>PID 1</em> process of the container
that controls the PostgreSQL server) to safely communicate with the
Kubernetes API server to coordinate actions and continuously provide
a reliable status of the <code>Cluster</code>.</dd>
<dt><code>services</code></dt>
<dd>The operator needs to control network access to the PostgreSQL cluster
(or the connection pooler) from applications, and properly manage
failover/switchover operations in an automated way (by assigning, for example,
the correct end-point of a service to the proper primary PostgreSQL instance).</dd>
</dl>
<h3 id="pod-security-policies">Pod Security Policies</h3>
<p>A <a href="https://kubernetes.io/docs/concepts/policy/pod-security-policy/">Pod Security Policy</a>
is the Kubernetes way to define security rules and specifications that a pod needs to meet
to run in a cluster.
For InfoSec reasons, every Kubernetes platform should implement them.</p>
<p>CloudNativePG does not require <em>privileged</em> mode for containers execution.
The PostgreSQL containers run as <code>postgres</code> system user. No component whatsoever requires running as <code>root</code>.</p>
<p>Likewise, Volumes access does not require <em>privileges</em> mode or <code>root</code> privileges either.
Proper permissions must be properly assigned by the Kubernetes platform and/or administrators.
The PostgreSQL containers run with a read-only root filesystem (i.e. no writable layer).</p>
<p>The operator explicitly sets the required security contexts.</p>
<h3 id="restricting-pod-access-using-apparmor">Restricting Pod access using AppArmor</h3>
<p>You can assign an
<a href="https://kubernetes.io/docs/tutorials/security/apparmor/">AppArmor</a> profile to
the <code>postgres</code>, <code>initdb</code>, <code>join</code>, <code>full-recovery</code> and <code>bootstrap-controller</code> containers inside every <code>Cluster</code> pod through the
<code>container.apparmor.security.beta.kubernetes.io</code> annotation.</p>
<p>!!! Seealso &ldquo;Example of cluster annotations&rdquo;</p>
<pre tabindex="0"><code>	kind: Cluster
	metadata:
		name: cluster-apparmor
		annotations:
			container.apparmor.security.beta.kubernetes.io/postgres: runtime/default
			container.apparmor.security.beta.kubernetes.io/initdb: runtime/default
			container.apparmor.security.beta.kubernetes.io/join: runtime/default
</code></pre><p>!!! Warning
Using this kind of annotations can result in your cluster to stop working.
If this is the case, the annotation can be safely removed from the <code>Cluster</code>.</p>
<p>The AppArmor configuration must be at Kubernetes node level, meaning that the
underlying operating system must have this option enable and properly
configured.</p>
<p>In case this is not the situation, and the annotations were added at the
<code>Cluster</code> creation time, pods will not be created. On the other hand, if you
add the annotations after the <code>Cluster</code> was created the pods in the cluster will
be unable to start and you will get an error like this:</p>
<pre tabindex="0"><code>metadata.annotations[container.apparmor.security.beta.kubernetes.io/postgres]: Forbidden: may not add AppArmor annotations]
</code></pre><p>In such cases, please refer to your Kubernetes administrators and ask for the
proper AppArmor profile to use.</p>
<h3 id="network-policies">Network Policies</h3>
<p>The pods created by the <code>Cluster</code> resource can be controlled by Kubernetes
<a href="https://kubernetes.io/docs/concepts/services-networking/network-policies/">network policies</a>
to enable/disable inbound and outbound network access at IP and TCP level.</p>
<p>!!! Important
The operator needs to communicate to each instance on TCP port 8000
to get information about the status of the PostgreSQL server. Please
make sure you keep this in mind in case you add any network policy,
and refer to the &ldquo;Exposed Ports&rdquo; section below for a list of ports used by
CloudNativePG for finer control.</p>
<p>Network policies are beyond the scope of this document.
Please refer to the <a href="https://kubernetes.io/docs/concepts/services-networking/network-policies/">&ldquo;Network policies&rdquo;</a>
section of the Kubernetes documentation for further information.</p>
<h4 id="exposed-ports">Exposed Ports</h4>
<p>CloudNativePG exposes ports at operator, instance manager and operand
levels, as listed in the table below:</p>
<table>
<thead>
<tr>
<th style="text-align:left">System</th>
<th style="text-align:left">Port number</th>
<th style="text-align:left">Exposing</th>
<th style="text-align:left">Name</th>
<th style="text-align:left">Certificates</th>
<th style="text-align:left">Authentication</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">operator</td>
<td style="text-align:left">9443</td>
<td style="text-align:left">webhook server</td>
<td style="text-align:left"><code>webhook-server</code></td>
<td style="text-align:left">TLS</td>
<td style="text-align:left">Yes</td>
</tr>
<tr>
<td style="text-align:left">operator</td>
<td style="text-align:left">8080</td>
<td style="text-align:left">metrics</td>
<td style="text-align:left"><code>metrics</code></td>
<td style="text-align:left">no TLS</td>
<td style="text-align:left">No</td>
</tr>
<tr>
<td style="text-align:left">instance manager</td>
<td style="text-align:left">9187</td>
<td style="text-align:left">metrics</td>
<td style="text-align:left"><code>metrics</code></td>
<td style="text-align:left">no TLS</td>
<td style="text-align:left">No</td>
</tr>
<tr>
<td style="text-align:left">instance manager</td>
<td style="text-align:left">8000</td>
<td style="text-align:left">status</td>
<td style="text-align:left"><code>status</code></td>
<td style="text-align:left">no TLS</td>
<td style="text-align:left">No</td>
</tr>
<tr>
<td style="text-align:left">operand</td>
<td style="text-align:left">5432</td>
<td style="text-align:left">PostgreSQL instance</td>
<td style="text-align:left"><code>postgresql</code></td>
<td style="text-align:left">optional TLS</td>
<td style="text-align:left">Yes</td>
</tr>
</tbody>
</table>
<h3 id="postgresql">PostgreSQL</h3>
<p>The current implementation of CloudNativePG automatically creates
passwords and <code>.pgpass</code> files for the <code>postgres</code> superuser and the database owner.</p>
<p>As far as encryption of password is concerned, CloudNativePG follows
the default behavior of PostgreSQL: starting from PostgreSQL 14,
<code>password_encryption</code> is by default set to <code>scram-sha-256</code>, while on earlier
versions it is set to <code>md5</code>.</p>
<p>!!! Important
Please refer to the <a href="https://www.postgresql.org/docs/current/auth-password.html">&ldquo;Password authentication&rdquo;</a>
section in the PostgreSQL documentation for details.</p>
<p>You can disable management of the <code>postgres</code> user password via secrets by setting
<code>enableSuperuserAccess</code> to <code>false</code>.</p>
<p>!!! Note
The operator supports toggling the <code>enableSuperuserAccess</code> option. When you
disable it on a running cluster, the operator will ignore the content of the secret,
remove it (if previously generated by the operator) and set the password of the
<code>postgres</code> user to <code>NULL</code> (de facto disabling remote access through password authentication).</p>
<p>See the <a href="architecture.md#secrets">&ldquo;Secrets&rdquo; section in the &ldquo;Architecture&rdquo; page</a> for more information.</p>
<p>You can use those files to configure application access to the database.</p>
<p>By default, every replica is automatically configured to connect in <strong>physical
async streaming replication</strong> with the current primary instance, with a special
user called <code>streaming_replica</code>. The connection between nodes is <strong>encrypted</strong>
and authentication is via <strong>TLS client certificates</strong> (please refer to the
[&ldquo;Client TLS/SSL Connections&rdquo;](ssl_connections.md#&ldquo;Client TLS/SSL Connections&rdquo;) page
for details).</p>
<p>Currently, the operator allows administrators to add <code>pg_hba.conf</code> lines directly in the manifest
as part of the <code>pg_hba</code> section of the <code>postgresql</code> configuration. The lines defined in the
manifest are added to a default <code>pg_hba.conf</code>.</p>
<p>For further detail on how <code>pg_hba.conf</code> is managed by the operator, see the
<a href="postgresql_conf.md#the-pg_hba-section">&ldquo;PostgreSQL Configuration&rdquo; page</a> of the documentation.</p>
<p>!!! Important
Examples assume that the Kubernetes cluster runs in a private and secure network.</p>
</p>
    </div>
    
    <div class="sticky top-0 px-4 bg-purple-2 leading-9 hidden md:hidden py-4" id="menu-list">
        
<ul>
    
    
    
    
    <li>
        <a href="/docs/v1.15.0/api_reference/">API Reference</a>
    </li>
    
    
    
    <li>
        <a href="/docs/v1.15.0/applications/">Connecting from an application</a>
    </li>
    
    
    
    <li>
        <a href="/docs/v1.15.0/architecture/">Architecture</a>
    </li>
    
    
    
    <li>
        <a href="/docs/v1.15.0/backup_recovery/">Backup and Recovery</a>
    </li>
    
    
    
    <li>
        <a href="/docs/v1.15.0/before_you_start/">Before You Start</a>
    </li>
    
    
    
    <li>
        <a href="/docs/v1.15.0/bootstrap/">Bootstrap</a>
    </li>
    
    
    
    <li>
        <a href="/docs/v1.15.0/certificates/">Certificates</a>
    </li>
    
    
    
    <li>
        <a href="/docs/v1.15.0/cnpg-plugin/">CloudNativePG Plugin</a>
    </li>
    
    
    
    <li>
        <a href="/docs/v1.15.0/commercial_support/">Commercial support</a>
    </li>
    
    
    
    <li>
        <a href="/docs/v1.15.0/connection_pooling/">Connection Pooling</a>
    </li>
    
    
    
    <li>
        <a href="/docs/v1.15.0/container_images/">Container Image Requirements</a>
    </li>
    
    
    
    <li>
        <a href="/docs/v1.15.0/e2e/">End-to-End Tests</a>
    </li>
    
    
    
    <li>
        <a href="/docs/v1.15.0/expose_pg_services/">Exposing Postgres Services</a>
    </li>
    
    
    
    <li>
        <a href="/docs/v1.15.0/failover/">Automated failover</a>
    </li>
    
    
    
    <li>
        <a href="/docs/v1.15.0/failure_modes/">Failure Modes</a>
    </li>
    
    
    
    <li>
        <a href="/docs/v1.15.0/fencing/">Fencing</a>
    </li>
    
    
    
    <li>
        <a href="/docs/v1.15.0/installation_upgrade/">Installation and upgrades</a>
    </li>
    
    
    
    <li>
        <a href="/docs/v1.15.0/instance_manager/">Postgres instance manager</a>
    </li>
    
    
    
    <li>
        <a href="/docs/v1.15.0/kubernetes_upgrade/">Kubernetes Upgrade</a>
    </li>
    
    
    
    <li>
        <a href="/docs/v1.15.0/labels_annotations/">Labels and annotations</a>
    </li>
    
    
    
    <li>
        <a href="/docs/v1.15.0/logging/">Logging</a>
    </li>
    
    
    
    <li>
        <a href="/docs/v1.15.0/monitoring/">Monitoring</a>
    </li>
    
    
    
    <li>
        <a href="/docs/v1.15.0/operator_capability_levels/">Operator Capability Levels</a>
    </li>
    
    
    
    <li>
        <a href="/docs/v1.15.0/operator_conf/">Operator configuration</a>
    </li>
    
    
    
    <li>
        <a href="/docs/v1.15.0/postgresql_conf/">PostgreSQL Configuration</a>
    </li>
    
    
    
    <li>
        <a href="/docs/v1.15.0/quickstart/">Quickstart</a>
    </li>
    
    
    
    <li>
        <a href="/docs/v1.15.0/release_notes/">Release notes</a>
    </li>
    
    
    
    <li>
        <a href="/docs/v1.15.0/replication/">Replication</a>
    </li>
    
    
    
    <li>
        <a href="/docs/v1.15.0/resource_management/">Resource management</a>
    </li>
    
    
    
    <li>
        <a href="/docs/v1.15.0/rolling_update/">Rolling Updates</a>
    </li>
    
    
    
    <li>
        <a href="/docs/v1.15.0/samples/">Configuration Samples</a>
    </li>
    
    
    
    <li>
        <a href="/docs/v1.15.0/scheduling/">Scheduling</a>
    </li>
    
    
    
    <li>
        <a href="/docs/v1.15.0/security/">Security</a>
    </li>
    
    
    
    <li>
        <a href="/docs/v1.15.0/ssl_connections/">Client TLS/SSL Connections</a>
    </li>
    
    
    
    <li>
        <a href="/docs/v1.15.0/storage/">Storage</a>
    </li>
    
    
    
    <li>
        <a href="/docs/v1.15.0/supported_releases/">Supported releases</a>
    </li>
    
    
    
    <li>
        <a href="/docs/v1.15.0/troubleshooting/">Troubleshooting</a>
    </li>
    
    
    
    <li>
        <a href="/docs/v1.15.0/use_cases/">Use cases</a>
    </li>
    
    
    
</ul>

<hr class="w-1/2">


<p>Documention by version</p>
<ul>
    
    <li>
        <a href="/docs/v1.15.0/">
            CloudNativePG
            v1.15.0
        </a>
    </li>
    
</ul>

    </div>
    <div class="px-4 well md:hidden">
        <p><h1 id="security">Security</h1>
<p>This section contains information about security for CloudNativePG,
that are analyzed at 3 different layers: Code, Container and Cluster.</p>
<p>!!! Warning
The information contained in this page must not exonerate you from
performing regular InfoSec duties on your Kubernetes cluster. Please
familiarize yourself with the <a href="https://kubernetes.io/docs/concepts/security/overview/">&ldquo;Overview of Cloud Native Security&rdquo;</a>
page from the Kubernetes documentation.</p>
<p>!!! Seealso &ldquo;About the 4C&rsquo;s Security Model&rdquo;
Please refer to <a href="https://www.enterprisedb.com/blog/4cs-security-model-kubernetes">&ldquo;The 4Câ€™s Security Model in Kubernetes&rdquo;</a>
blog article to get a better understanding and context of the approach EDB
has taken with security in CloudNativePG.</p>
<h2 id="code">Code</h2>
<p>Source code of CloudNativePG is <em>systematically scanned</em> for static analysis purposes,
including <strong>security problems</strong>, using a popular open-source linter for Go called
<a href="https://github.com/golangci/golangci-lint">GolangCI-Lint</a> directly in the CI/CD pipeline.
GolangCI-Lint can run several <em>linters</em> on the same source code.</p>
<p>One of these is <a href="https://github.com/securego/gosec">Golang Security Checker</a>, or simply <code>gosec</code>,
a linter that scans the abstract syntactic tree of the source against a set of rules aimed at
the discovery of well-known vulnerabilities, threats, and weaknesses hidden in
the code such as hard-coded credentials, integer overflows and SQL injections - to name a few.</p>
<p>!!! Important
A failure in the static code analysis phase of the CI/CD pipeline is a blocker
for the entire delivery of CloudNativePG, meaning that each commit is validated
against all the linters defined by GolangCI-Lint.</p>
<h2 id="container">Container</h2>
<p>Every container image that is part of CloudNativePG is automatically built via CI/CD pipelines following every commit.
Such images include not only the operator&rsquo;s, but also the operands&rsquo; - specifically every supported PostgreSQL version.
Within the pipelines, images are scanned with:</p>
<ul>
<li><a href="https://github.com/goodwithtech/dockle">Dockle</a>: for best practices in terms
of the container build process</li>
</ul>
<p>!!! Important
All operand images are automatically rebuilt once a day by our pipelines in case
of security updates at the base image and package level, providing <strong>patch level updates</strong>
for the container images that EDB distributes.</p>
<p>The following guidelines and frameworks have been taken into account for container-level security:</p>
<ul>
<li>the <a href="https://dl.dod.cyber.mil/wp-content/uploads/devsecops/pdf/DevSecOps_Enterprise_Container_Image_Creation_and_Deployment_Guide_2.6-Public-Release.pdf">&ldquo;Container Image Creation and Deployment Guide&rdquo;</a>,
developed by the Defense Information Systems Agency (DISA) of the United States Department of Defense (DoD)</li>
<li>the <a href="https://www.cisecurity.org/benchmark/docker/">&ldquo;CIS Benchmark for Docker&rdquo;</a>,
developed by the Center for Internet Security (CIS)</li>
</ul>
<p>!!! Seealso &ldquo;About the Container level security&rdquo;
Please refer to <a href="https://www.enterprisedb.com/blog/security-and-containers-cloud-native-postgresql">&ldquo;Security and Containers in CloudNativePG&rdquo;</a>
blog article for more information about the approach that EDB has taken on
security at the container level in CloudNativePG.</p>
<h2 id="cluster">Cluster</h2>
<p>Security at the cluster level takes into account all Kubernetes components that
form both the control plane and the nodes, as well as the applications that run in
the cluster (PostgreSQL included).</p>
<h3 id="role-based-access-control-rbac">Role Based Access Control (RBAC)</h3>
<p>The operator interacts with the Kubernetes API server with a dedicated service
account called <code>cnpg-manager</code>. In Kubernetes this is installed
by default in the <code>cnpg-system</code> namespace, with a cluster role
binding between this service account and the <code>cnpg-manager</code>
cluster role which defines the set of rules/resources/verbs granted to the operator.</p>
<p>!!! Important
The above permissions are exclusively reserved for the operator&rsquo;s service
account to interact with the Kubernetes API server.  They are not directly
accessible by the users of the operator that interact only with <code>Cluster</code>,
<code>Pooler</code>, <code>Backup</code>, and <code>ScheduledBackup</code> resources.</p>
<p>Below we provide some examples and, most importantly, the reasons why
CloudNativePG requires full or partial management of standard Kubernetes
namespaced resources.</p>
<dl>
<dt><code>configmaps</code></dt>
<dd>The operator needs to create and manage default config maps for
the Prometheus exporter monitoring metrics.</dd>
<dt><code>deployments</code></dt>
<dd>The operator needs to manage a PgBouncer connection pooler
using a standard Kubernetes <code>Deployment</code> resource.</dd>
<dt><code>jobs</code></dt>
<dd>The operator needs to handle jobs to manage different <code>Cluster</code>&rsquo;s phases.</dd>
<dt><code>persistentvolumeclaims</code></dt>
<dd>The volume where the <code>PGDATA</code> resides is the
central element of a PostgreSQL <code>Cluster</code> resource; the operator needs
to interact with the selected storage class to dynamically provision
the requested volumes, based on the defined scheduling policies.</dd>
<dt><code>pods</code></dt>
<dd>The operator needs to manage <code>Cluster</code>&rsquo;s instances.</dd>
<dt><code>secrets</code></dt>
<dd>Unless you provide certificates and passwords to your <code>Cluster</code>
objects, the operator adopts the &ldquo;convention over configuration&rdquo; paradigm by
self-provisioning random generated passwords and TLS certificates, and by
storing them in secrets.</dd>
<dt><code>serviceaccounts</code></dt>
<dd>The operator needs to create a service account that
enables the instance manager (which is the <em>PID 1</em> process of the container
that controls the PostgreSQL server) to safely communicate with the
Kubernetes API server to coordinate actions and continuously provide
a reliable status of the <code>Cluster</code>.</dd>
<dt><code>services</code></dt>
<dd>The operator needs to control network access to the PostgreSQL cluster
(or the connection pooler) from applications, and properly manage
failover/switchover operations in an automated way (by assigning, for example,
the correct end-point of a service to the proper primary PostgreSQL instance).</dd>
</dl>
<h3 id="pod-security-policies">Pod Security Policies</h3>
<p>A <a href="https://kubernetes.io/docs/concepts/policy/pod-security-policy/">Pod Security Policy</a>
is the Kubernetes way to define security rules and specifications that a pod needs to meet
to run in a cluster.
For InfoSec reasons, every Kubernetes platform should implement them.</p>
<p>CloudNativePG does not require <em>privileged</em> mode for containers execution.
The PostgreSQL containers run as <code>postgres</code> system user. No component whatsoever requires running as <code>root</code>.</p>
<p>Likewise, Volumes access does not require <em>privileges</em> mode or <code>root</code> privileges either.
Proper permissions must be properly assigned by the Kubernetes platform and/or administrators.
The PostgreSQL containers run with a read-only root filesystem (i.e. no writable layer).</p>
<p>The operator explicitly sets the required security contexts.</p>
<h3 id="restricting-pod-access-using-apparmor">Restricting Pod access using AppArmor</h3>
<p>You can assign an
<a href="https://kubernetes.io/docs/tutorials/security/apparmor/">AppArmor</a> profile to
the <code>postgres</code>, <code>initdb</code>, <code>join</code>, <code>full-recovery</code> and <code>bootstrap-controller</code> containers inside every <code>Cluster</code> pod through the
<code>container.apparmor.security.beta.kubernetes.io</code> annotation.</p>
<p>!!! Seealso &ldquo;Example of cluster annotations&rdquo;</p>
<pre tabindex="0"><code>	kind: Cluster
	metadata:
		name: cluster-apparmor
		annotations:
			container.apparmor.security.beta.kubernetes.io/postgres: runtime/default
			container.apparmor.security.beta.kubernetes.io/initdb: runtime/default
			container.apparmor.security.beta.kubernetes.io/join: runtime/default
</code></pre><p>!!! Warning
Using this kind of annotations can result in your cluster to stop working.
If this is the case, the annotation can be safely removed from the <code>Cluster</code>.</p>
<p>The AppArmor configuration must be at Kubernetes node level, meaning that the
underlying operating system must have this option enable and properly
configured.</p>
<p>In case this is not the situation, and the annotations were added at the
<code>Cluster</code> creation time, pods will not be created. On the other hand, if you
add the annotations after the <code>Cluster</code> was created the pods in the cluster will
be unable to start and you will get an error like this:</p>
<pre tabindex="0"><code>metadata.annotations[container.apparmor.security.beta.kubernetes.io/postgres]: Forbidden: may not add AppArmor annotations]
</code></pre><p>In such cases, please refer to your Kubernetes administrators and ask for the
proper AppArmor profile to use.</p>
<h3 id="network-policies">Network Policies</h3>
<p>The pods created by the <code>Cluster</code> resource can be controlled by Kubernetes
<a href="https://kubernetes.io/docs/concepts/services-networking/network-policies/">network policies</a>
to enable/disable inbound and outbound network access at IP and TCP level.</p>
<p>!!! Important
The operator needs to communicate to each instance on TCP port 8000
to get information about the status of the PostgreSQL server. Please
make sure you keep this in mind in case you add any network policy,
and refer to the &ldquo;Exposed Ports&rdquo; section below for a list of ports used by
CloudNativePG for finer control.</p>
<p>Network policies are beyond the scope of this document.
Please refer to the <a href="https://kubernetes.io/docs/concepts/services-networking/network-policies/">&ldquo;Network policies&rdquo;</a>
section of the Kubernetes documentation for further information.</p>
<h4 id="exposed-ports">Exposed Ports</h4>
<p>CloudNativePG exposes ports at operator, instance manager and operand
levels, as listed in the table below:</p>
<table>
<thead>
<tr>
<th style="text-align:left">System</th>
<th style="text-align:left">Port number</th>
<th style="text-align:left">Exposing</th>
<th style="text-align:left">Name</th>
<th style="text-align:left">Certificates</th>
<th style="text-align:left">Authentication</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">operator</td>
<td style="text-align:left">9443</td>
<td style="text-align:left">webhook server</td>
<td style="text-align:left"><code>webhook-server</code></td>
<td style="text-align:left">TLS</td>
<td style="text-align:left">Yes</td>
</tr>
<tr>
<td style="text-align:left">operator</td>
<td style="text-align:left">8080</td>
<td style="text-align:left">metrics</td>
<td style="text-align:left"><code>metrics</code></td>
<td style="text-align:left">no TLS</td>
<td style="text-align:left">No</td>
</tr>
<tr>
<td style="text-align:left">instance manager</td>
<td style="text-align:left">9187</td>
<td style="text-align:left">metrics</td>
<td style="text-align:left"><code>metrics</code></td>
<td style="text-align:left">no TLS</td>
<td style="text-align:left">No</td>
</tr>
<tr>
<td style="text-align:left">instance manager</td>
<td style="text-align:left">8000</td>
<td style="text-align:left">status</td>
<td style="text-align:left"><code>status</code></td>
<td style="text-align:left">no TLS</td>
<td style="text-align:left">No</td>
</tr>
<tr>
<td style="text-align:left">operand</td>
<td style="text-align:left">5432</td>
<td style="text-align:left">PostgreSQL instance</td>
<td style="text-align:left"><code>postgresql</code></td>
<td style="text-align:left">optional TLS</td>
<td style="text-align:left">Yes</td>
</tr>
</tbody>
</table>
<h3 id="postgresql">PostgreSQL</h3>
<p>The current implementation of CloudNativePG automatically creates
passwords and <code>.pgpass</code> files for the <code>postgres</code> superuser and the database owner.</p>
<p>As far as encryption of password is concerned, CloudNativePG follows
the default behavior of PostgreSQL: starting from PostgreSQL 14,
<code>password_encryption</code> is by default set to <code>scram-sha-256</code>, while on earlier
versions it is set to <code>md5</code>.</p>
<p>!!! Important
Please refer to the <a href="https://www.postgresql.org/docs/current/auth-password.html">&ldquo;Password authentication&rdquo;</a>
section in the PostgreSQL documentation for details.</p>
<p>You can disable management of the <code>postgres</code> user password via secrets by setting
<code>enableSuperuserAccess</code> to <code>false</code>.</p>
<p>!!! Note
The operator supports toggling the <code>enableSuperuserAccess</code> option. When you
disable it on a running cluster, the operator will ignore the content of the secret,
remove it (if previously generated by the operator) and set the password of the
<code>postgres</code> user to <code>NULL</code> (de facto disabling remote access through password authentication).</p>
<p>See the <a href="architecture.md#secrets">&ldquo;Secrets&rdquo; section in the &ldquo;Architecture&rdquo; page</a> for more information.</p>
<p>You can use those files to configure application access to the database.</p>
<p>By default, every replica is automatically configured to connect in <strong>physical
async streaming replication</strong> with the current primary instance, with a special
user called <code>streaming_replica</code>. The connection between nodes is <strong>encrypted</strong>
and authentication is via <strong>TLS client certificates</strong> (please refer to the
[&ldquo;Client TLS/SSL Connections&rdquo;](ssl_connections.md#&ldquo;Client TLS/SSL Connections&rdquo;) page
for details).</p>
<p>Currently, the operator allows administrators to add <code>pg_hba.conf</code> lines directly in the manifest
as part of the <code>pg_hba</code> section of the <code>postgresql</code> configuration. The lines defined in the
manifest are added to a default <code>pg_hba.conf</code>.</p>
<p>For further detail on how <code>pg_hba.conf</code> is managed by the operator, see the
<a href="postgresql_conf.md#the-pg_hba-section">&ldquo;PostgreSQL Configuration&rdquo; page</a> of the documentation.</p>
<p>!!! Important
Examples assume that the Kubernetes cluster runs in a private and secure network.</p>
</p>
    </div>
    
</div>

<div class="flex gap-3 bg-gray-1 px-4 py-4 cnp-blue md:hidden fixed bottom-0 w-full" id="menu-toggle">
    <img src="/icons/menu-unfold-outlined.svg" alt="">
    <h4 class="text-lg">Documentation</h4>
</div>

<script>
    const menuToggle = document.getElementById('menu-toggle')
    const menuList = document.getElementById('menu-list')
  
    menuToggle.addEventListener('click', () => {
      menuList.classList.toggle('hidden');
    })
</script>


    <footer class="text-center pb-24">
    <p class="text-sm charcoal md:w-1/2 mx-auto md:pt-10 px-6 pt-12">

      &copy; The CloudNativePG Contributors.<br />

      <a href="https://www.linuxfoundation.org/trademark-usage/"
        class="red-1">The Linux Foundation has registered trademarks and uses
        trademarks</a>.<br />

      <a href="https://www.postgresql.org/about/policies/trademarks"
        class="red-1">Postgres, PostgreSQL and the Slonik Logo are trademarks or
        registered trademarks of the PostgreSQL Community Association of Canada, and
        used with their permission</a>.

    </p>
</footer>

  </div>
  
  <script src="https://cdn.usefathom.com/script.js" data-site="GSMQCVAJ" defer></script>
  
</body>

</html>